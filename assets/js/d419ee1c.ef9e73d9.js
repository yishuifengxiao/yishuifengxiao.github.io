"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4384],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>k});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(t),m=r,k=u["".concat(p,".").concat(m)]||u[m]||c[m]||i;return t?a.createElement(k,o(o({ref:n},d),{},{components:t})):a.createElement(k,o({ref:n},d))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},84358:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=t(87462),r=(t(67294),t(3905));const i={sidebar_position:4,title:"\u9a8c\u8bc1\u7801"},o=void 0,l={unversionedId:"code",id:"code",title:"\u9a8c\u8bc1\u7801",description:"\u8be5\u529f\u80fd\u4e3b\u8981\u662f\u9a8c\u8bc1\u7801\u652f\u6301\u529f\u80fd\uff0c\u4e0d\u4f9d\u8d56\u4e0espringboot\u5176\u4ed6\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u5728\u4efb\u4f55\u9879\u76eespring boot\u9879\u76ee\u4e2d\u4f7f\u7528\uff0c\u4e3b\u8981\u652f\u6301\u56fe\u5f62\u9a8c\u8bc1\u7801\u3001\u90ae\u4ef6\u9a8c\u8bc1\u7801\u548c\u77ed\u4fe1\u9a8c\u8bc1\u7801\u3002",source:"@site/wiki/common-starter/code.md",sourceDirName:".",slug:"/code",permalink:"/common-starter/code",draft:!1,tags:[],version:"current",lastUpdatedBy:"yishuifengxiao",lastUpdatedAt:1676012874,formattedLastUpdatedAt:"2023\u5e742\u670810\u65e5",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"\u9a8c\u8bc1\u7801"},sidebar:"tutorialSidebar",previous:{title:"\u901a\u7528\u589e\u5f3a",permalink:"/common-starter/cache"},next:{title:"spring data jdbc",permalink:"/common-starter/jdbc"}},p={},s=[{value:"\u4e00 \u901a\u7528\u914d\u7f6e",id:"\u4e00-\u901a\u7528\u914d\u7f6e",level:2},{value:"\u4e8c \u56fe\u5f62\u9a8c\u8bc1\u7801",id:"\u4e8c-\u56fe\u5f62\u9a8c\u8bc1\u7801",level:2},{value:"2.1 \u57fa\u7840\u4f7f\u7528",id:"21-\u57fa\u7840\u4f7f\u7528",level:3},{value:"\u914d\u7f6e\u53c2\u6570",id:"\u914d\u7f6e\u53c2\u6570",level:3},{value:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801",id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801",level:3},{value:"\u4e09 \u90ae\u4ef6\u9a8c\u8bc1\u7801",id:"\u4e09-\u90ae\u4ef6\u9a8c\u8bc1\u7801",level:2},{value:"\u5feb\u901f\u542f\u52a8",id:"\u5feb\u901f\u542f\u52a8",level:3},{value:"\u6821\u9a8c\u9a8c\u8bc1\u7801",id:"\u6821\u9a8c\u9a8c\u8bc1\u7801",level:3},{value:"\u914d\u7f6e\u53c2\u6570",id:"\u914d\u7f6e\u53c2\u6570-1",level:3},{value:"\u53d1\u9001\u90ae\u4ef6",id:"\u53d1\u9001\u90ae\u4ef6",level:3},{value:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801",id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801-1",level:3},{value:"\u56db \u77ed\u4fe1\u9a8c\u8bc1\u7801",id:"\u56db-\u77ed\u4fe1\u9a8c\u8bc1\u7801",level:2},{value:"\u5feb\u9012\u542f\u52a8",id:"\u5feb\u9012\u542f\u52a8",level:3},{value:"\u6821\u9a8c\u9a8c\u8bc1\u7801",id:"\u6821\u9a8c\u9a8c\u8bc1\u7801-1",level:3},{value:"\u53c2\u6570\u914d\u7f6e",id:"\u53c2\u6570\u914d\u7f6e",level:3},{value:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801",id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801-2",level:3},{value:"\u4e94 \u8fdb\u9636\u4f7f\u7528",id:"\u4e94-\u8fdb\u9636\u4f7f\u7528",level:2},{value:"\u5b58\u50a8\u9a8c\u8bc1\u7801\u5230Redis",id:"\u5b58\u50a8\u9a8c\u8bc1\u7801\u5230redis",level:3}],d={toc:s},u="wrapper";function c(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u8be5\u529f\u80fd\u4e3b\u8981\u662f\u9a8c\u8bc1\u7801\u652f\u6301\u529f\u80fd\uff0c\u4e0d\u4f9d\u8d56\u4e0espringboot\u5176\u4ed6\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u5728\u4efb\u4f55\u9879\u76eespring boot\u9879\u76ee\u4e2d\u4f7f\u7528\uff0c\u4e3b\u8981\u652f\u6301\u56fe\u5f62\u9a8c\u8bc1\u7801\u3001\u90ae\u4ef6\u9a8c\u8bc1\u7801\u548c\u77ed\u4fe1\u9a8c\u8bc1\u7801\u3002"),(0,r.kt)("p",null,"\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9a8c\u8bc1\u7801\u529f\u80fd\u9ed8\u8ba4\u5173\u95ed\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u914d\u7f6e\u8fdb\u884c\u5f00\u542f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"yishuifengxiao.code.enable=true\n")),(0,r.kt)("h2",{id:"\u4e00-\u901a\u7528\u914d\u7f6e"},"\u4e00 \u901a\u7528\u914d\u7f6e"),(0,r.kt)("p",null,"\u4f7f\u7528\u9a8c\u8bc1\u7801\u529f\u80fd\u65f6\uff0c\u53ef\u4ee5\u5728\u9879\u76ee\u4e2d\u6ce8\u5165\u4ee5\u4e0b\u4ee3\u7801"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Autowired\nprivate CodeProcessor codeProcessor;\n")),(0,r.kt)("p",null,"CodeProcessor\u63a5\u53e3\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u521b\u5efa\u6821\u9a8c\u7801\n * \n * @param request  \u7528\u6237\u8bf7\u6c42\n * @param codeType \u9a8c\u8bc1\u7801\u7684\u7c7b\u578b\n * @return \u521b\u5efa\u5e76\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\n * @throws CustomException  \u521b\u5efa\u6216\u53d1\u9001\u9a8c\u8bc1\u7801\u65f6\u51fa\u73b0\u95ee\u9898\n */\nValidateCode create(ServletWebRequest request, CodeType codeType) throws CustomException ;\n\n/**\n * <p>\n * \u521b\u5efa\u6821\u9a8c\u7801\n * </p>\n * \n * \u751f\u6210\u9a8c\u8bc1\u7801\u5b58\u50a8\u65f6\u7684key\u7684\u542b\u4e49\u5982\u4e0b:\n * <ul>\n * <li>\u5bf9\u4e8e\u77ed\u4fe1\u9a8c\u8bc1\u7801,key\u4e3a\u624b\u673a\u53f7</li>\n * <li>\u5bf9\u4e8e\u90ae\u4ef6\u9a8c\u8bc1\u7801\uff0ckey\u4e3a\u90ae\u7bb1</li>\n * <li>\u5bf9\u4e8e\u56fe\u50cf\u9a8c\u8bc1\u7801\uff0ckey\u4e3asessionid\u6216\u6307\u5b9a\u7684\u503c</li>\n * </ul>\n * \n * @param request  \u7528\u6237\u8bf7\u6c42\n * @param key      \u9a8c\u8bc1\u7801\u7684\u53d1\u9001\u76ee\u6807\n * @param codeType \u9a8c\u8bc1\u7801\u7684\u7c7b\u578b\n * @return \u521b\u5efa\u5e76\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\n * @throws CustomException  \u521b\u5efa\u6216\u53d1\u9001\u9a8c\u8bc1\u7801\u65f6\u51fa\u73b0\u95ee\u9898\n */\nValidateCode create(ServletWebRequest request, String key, CodeType codeType) throws CustomException ;\n/**\n * \u521b\u5efa\u6821\u9a8c\u7801\u5e76\u53d1\u9001\u9a8c\u8bc1\u7801\n * \n * @param request  \u7528\u6237\u8bf7\u6c42\n * @param codeType \u9a8c\u8bc1\u7801\u7684\u7c7b\u578b\n * @return \u521b\u5efa\u5e76\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\n * @throws CustomException  \u521b\u5efa\u6216\u53d1\u9001\u9a8c\u8bc1\u7801\u65f6\u51fa\u73b0\u95ee\u9898\n */\nValidateCode createAndSend(ServletWebRequest request, CodeType codeType) throws CustomException ;\n\n/**\n * <p>\n * \u521b\u5efa\u6821\u9a8c\u7801\u5e76\u53d1\u9001\u9a8c\u8bc1\u7801\n * </p>\n * \n * \u751f\u6210\u9a8c\u8bc1\u7801\u5b58\u50a8\u65f6\u7684key\u7684\u542b\u4e49\u5982\u4e0b:\n * <ul>\n * <li>\u5bf9\u4e8e\u77ed\u4fe1\u9a8c\u8bc1\u7801,key\u4e3a\u624b\u673a\u53f7</li>\n * <li>\u5bf9\u4e8e\u90ae\u4ef6\u9a8c\u8bc1\u7801\uff0ckey\u4e3a\u90ae\u7bb1</li>\n * <li>\u5bf9\u4e8e\u56fe\u50cf\u9a8c\u8bc1\u7801\uff0ckey\u4e3asessionid\u6216\u6307\u5b9a\u7684\u503c</li>\n * </ul>\n * \n * @param request  \u7528\u6237\u8bf7\u6c42\n * @param key      \u9a8c\u8bc1\u7801\u7684\u53d1\u9001\u76ee\u6807\n * @param codeType \u9a8c\u8bc1\u7801\u7684\u7c7b\u578b\n * @return \u521b\u5efa\u5e76\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\n * @throws CustomException  \u521b\u5efa\u6216\u53d1\u9001\u9a8c\u8bc1\u7801\u65f6\u51fa\u73b0\u95ee\u9898\n */\nValidateCode createAndSend(ServletWebRequest request, String key, CodeType codeType) throws CustomException ;\n\n/**\n * <p>\n * \u6821\u9a8c\u7528\u6237\u8bf7\u6c42\u4e2d\u643a\u5e26\u7684\u9a8c\u8bc1\u7801\u662f\u5426\u6b63\u786e\n * </p>\n * \u5728\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d\u65f6\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4e3b\u8981\u5f02\u5e38\u573a\u666f\u6709:\n * <ul>\n * <li>\u9a8c\u8bc1\u7801\u4e0d\u5b58\u5728</li>\n * <li>\u5b58\u50a8\u7684\u9a8c\u8bc1\u7801\u5df2\u8fc7\u671f</li>\n * <li>\u5b58\u50a8\u7684\u9a8c\u8bc1\u7801\u4e0e\u7ed9\u5b9a\u7684\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d</li>\n * </ul>\n * \n * @param request  \u7528\u6237\u8bf7\u6c42\n * @param codeType \u9a8c\u8bc1\u7801\u7c7b\u578b\n * @throws CustomException  \u9a8c\u8bc1\u7801\u4e0d\u5339\u914d\u6216\u5df2\u8fc7\u671f\u7b49\u672a\u901a\u8fc7\u9a8c\u8bc1\u65f6\n */\nvoid validate(ServletWebRequest request, CodeType codeType) throws CustomException ;\n\n/**\n * <p>\n * \u6839\u636e\u9a8c\u8bc1\u7801\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u5224\u65ad\u7ed9\u5b9a\u7684\u9a8c\u8bc1\u7801\u662f\u5426\u6b63\u786e\n * </p>\n * \u5728\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d\u65f6\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4e3b\u8981\u5f02\u5e38\u573a\u666f\u6709:\n * <ul>\n * <li>\u9a8c\u8bc1\u7801\u4e0d\u5b58\u5728</li>\n * <li>\u5b58\u50a8\u7684\u9a8c\u8bc1\u7801\u5df2\u8fc7\u671f</li>\n * <li>\u5b58\u50a8\u7684\u9a8c\u8bc1\u7801\u4e0e\u7ed9\u5b9a\u7684\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d</li>\n * </ul>\n * \n * @param key           \u9a8c\u8bc1\u7801\u7684\u552f\u4e00\u6807\u8bc6\u7b26\n * @param codeInRequest \u7ed9\u5b9a\u7684\u9a8c\u8bc1\u7801\n * @throws CustomException  \u9a8c\u8bc1\u7801\u4e0d\u5339\u914d\u6216\u5df2\u8fc7\u671f\u7b49\u672a\u901a\u8fc7\u9a8c\u8bc1\u65f6\n */\nvoid validate(String key, String codeInRequest) throws CustomException ;\n")),(0,r.kt)("p",null,"\u901a\u7528\u914d\u7f6e\u5982\u4e0b:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"# \u5c06\u9a8c\u8bc1\u7801\u5b58\u50a8\u5230Redis\u65f6\u7684key\u7684\u524d\u7f00\uff0c\u9ed8\u8ba4\u503c\u4e3a validate_code_\nyishuifengxiao.code.prefix=validate_code_store_redis\n# \u662f\u5426\u5728\u9a8c\u8bc1\u6210\u529f\u540e\u5220\u9664\u9a8c\u8bc1\u8fc7\u7684\u9a8c\u8bc1\u7801,true\u8868\u793a\u5220\u9664\uff0cfalse\u4e0d\u5220\u9664\nyishuifengxiao.code.delete-on-success=true\n")),(0,r.kt)("h2",{id:"\u4e8c-\u56fe\u5f62\u9a8c\u8bc1\u7801"},"\u4e8c \u56fe\u5f62\u9a8c\u8bc1\u7801"),(0,r.kt)("h3",{id:"21-\u57fa\u7840\u4f7f\u7528"},"2.1 \u57fa\u7840\u4f7f\u7528"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u53d1\u9001\u9a8c\u8bc1\u7801")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'   /**\n     * \u751f\u6210\u4e14\u53d1\u9001\u9a8c\u8bc1\u7801\n     *\n     * @param request\n     * @param response\n     * @throws CustomException\n     */\n    @GetMapping("/code/image")\n    @ResponseBody\n    public void image(HttpServletRequest request, HttpServletResponse response) throws CustomException {\n\n        codeProcessor.createAndSend(new ServletWebRequest(request, response), CodeType.IMAGE);\n    }\n')),(0,r.kt)("p",null,"\u5728\u4ee5\u4e0a\u4ee3\u7801\u540e\uff0c\u7528\u6237\u5373\u53ef\u901a\u8fc7"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"http://{ip}:{port}/code/image?image=\u552f\u4e00\u7684\u968f\u673a\u503c")),(0,r.kt)("p",null,"\u83b7\u53d6\u56fe\u5f62\u9a8c\u8bc1\u7801\u4e86\u3002"),(0,r.kt)("p",null,"\u5728\u4e0a\u8ff0\u8bf7\u6c42\u4e2d\uff0c\u7528\u6237\u5e94\u8be5\u5c06image\u53c2\u6570\u5b58\u50a8\u8d77\u6765\uff0c\u56e0\u4e3a\u5728\u6821\u9a8c\u9a8c\u8bc1\u7801\u65f6\u9700\u8981\u7528\u5230\u3002"),(0,r.kt)("p",null,"\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u5f53\u7528\u6237\u8bf7\u6c42\u4e2d\u6ca1\u6709\u643a\u5e26",(0,r.kt)("inlineCode",{parentName:"p"},"image"),"\u53c2\u6570\u65f6\uff0c\u7ec4\u4ef6\u4f1a\u81ea\u52a8\u4ece\u8bf7\u6c42\u7684cookie\u4e2d\u83b7\u53d6\u540d\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"SESSION"),"\u7684cookie\u7684\u503c\u4f5c\u4e3a\u9a8c\u8bc1\u7801\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6821\u9a8c\u9a8c\u8bc1\u7801")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},' @GetMapping("/image/validate")\n    @ResponseBody\n    public Response<String> validate(HttpServletRequest request, HttpServletResponse response){\n        try {\n          codeProcessor.validate(new ServletWebRequest(request, response),CodeType.IMAGE);\n        } catch (ValidateException e) {\n            return Response.error(e.getMessage());\n        }\n        return Response.suc();\n    }\n')),(0,r.kt)("p",null,"\u7528\u6237\u5728\u9a8c\u8bc1\u56fe\u5f62\u9a8c\u8bc1\u7801\u65f6\uff0c\u5373\u53ef\u7528\u8fc7"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"http://ip:port/image/validate?image=\u552f\u4e00\u7684\u968f\u673a\u503c&image_code=\u9a8c\u8bc1\u7801\u5185\u5bb9")),(0,r.kt)("p",null,"\u6765\u5224\u65ad\u9a8c\u8bc1\u7801\u662f\u5426\u6b63\u786e\u3002"),(0,r.kt)("p",null,"\u3010\u6ce8\u610f\u3011\u4e0a\u8ff0\u8bf7\u6c42\u4e2dimage\u53c2\u6570\u7684\u503c\u5e94\u8be5\u4e0e\u8bf7\u6c42\u4e2d\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684url\u4e2d\u7684image\u53c2\u6570\u7684\u503c\u4fdd\u6301\u4e00\u81f4\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u7279\u6b8a\u63d0\u793a\uff1a\u5bf9\u4e8e\u524d\u540e\u7aef\u90e8\u7f72\u5728\u4e00\u8d77\u7684\u5355\u4f53\u5e94\u7528\uff0c\u4e0a\u8ff0\u4e24\u4e2a\u8bf7\u6c42\u4e2d\u7684image\u53c2\u6570\u90fd\u53ef\u4ee5\u7701\u7565\u6389\u3002")),(0,r.kt)("h3",{id:"\u914d\u7f6e\u53c2\u6570"},"\u914d\u7f6e\u53c2\u6570"),(0,r.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0c\u56fe\u5f62\u9a8c\u8bc1\u7801\u76f8\u5173\u7684\u914d\u7f6e\u6709"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"#\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u6807\u8bc6\u7b26\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a image\nyishuifengxiao.code.image.code-key=image\n#\u8bf7\u6c42\u4e2d\u83b7\u53d6\u90ae\u4ef6\u9a8c\u8bc1\u7801\u5bf9\u5e94\u7684\u503c\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3aimage_code\nyishuifengxiao.code.image.code-value=image_code\n#\u9a8c\u8bc1\u7801\u662f\u5426\u5305\u542b\u5b57\u6bcd,\u9ed8\u8ba4\u5305\u542b\nyishuifengxiao.code.image.contain-letter=true\n#\u9a8c\u8bc1\u7801\u662f\u5426\u5305\u542b\u6570\u5b57,\u9ed8\u8ba4\u5305\u542b\nyishuifengxiao.code.image.contain-number=true\n#\u9a8c\u8bc1\u7801\u7684\u5931\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba4\u4e3a300s\nyishuifengxiao.code.image.expire-in=300\n#\u662f\u5426\u751f\u6210\u5e72\u6270\u6761\u7eb9\u80cc\u666f\uff0c\u9ed8\u8ba4\u4e3afalse\nyishuifengxiao.code.image.fringe=false\n#\u9a8c\u8bc1\u7801\u7684\u9ad8\u5ea6,\u9ed8\u8ba4\u4e3a 28\nyishuifengxiao.code.image.height=28\n#\u9a8c\u8bc1\u7801\u7684\u957f\u5ea6,\u9ed8\u8ba4\u4e3a4\nyishuifengxiao.code.image.length=4\n#\u9a8c\u8bc1\u7801\u7684\u5bbd\u5ea6,\u9ed8\u8ba4\u4e3a70\nyishuifengxiao.code.image.width=70\n")),(0,r.kt)("b",null,"\u6ce8\u610f\uff1a"),(0,r.kt)("p",null,"\u5728\u751f\u6210\u9a8c\u8bc1\u7801\u548c\u9a8c\u8bc1\u9a8c\u8bc1\u7801\u7684\u8bf7\u6c42\u4e2d\uff0c\u8bf7\u6c42\u53c2\u6570\u4e2d\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"image"),"\u53c2\u6570\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.image.code-key"),"\u5c5e\u6027,",(0,r.kt)("inlineCode",{parentName:"p"},"image_code"),"\u53c2\u6570\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.image.code-value"),"\u5c5e\u6027\u51b3\u5b9a\u3002\u5728\u67d0\u4e9b\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e24\u4e2a\u914d\u7f6e\u4fee\u6539\u8bf7\u6c42\u53c2\u6570\u3002"),(0,r.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801"},"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u9488\u5bf9\u4e8e\u56fe\u5f62\u9a8c\u8bc1\u7801\uff0c\u7ec4\u4ef6\u5bf9\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u751f\u6210\u505a\u4e00\u4e2a\u9ed8\u8ba4\u5b9e\u73b0\uff0c\u5982\u679c\u751f\u6210\u7684\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u5185\u5bb9\u4e0d\u6ee1\u8db3\u7528\u6237\u9700\u8981\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"imageCodeGenerator")," \u7684\u5b9e\u4f8b\u6ce8\u5165\u5230spring\u4e2d\u5373\u53ef\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component("imageCodeGenerator")\npublic class ImageCodeGenerator implements CodeGenerator{\n    \n    @Override\n    public ImageCode generate(ServletWebRequest servletWebRequest){\n      //\u5b9e\u73b0\u81ea\u5df1\u7684\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u751f\u6210\u903b\u8f91  \n    }\n}\n')),(0,r.kt)("h2",{id:"\u4e09-\u90ae\u4ef6\u9a8c\u8bc1\u7801"},"\u4e09 \u90ae\u4ef6\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u5728\u4f7f\u7528\u90ae\u7bb1\u9a8c\u8bc1\u7801\u65f6\uff0c\u9700\u8981\u5148\u8fdb\u884c\u4e0b\u8ff0\u914d\u7f6e\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5728\u9879\u76ee\u4e2d\u5bfc\u5165\u90ae\u4ef6\u53d1\u9001\u76f8\u5173\u7684\u4f9d\u8d56")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-mail</artifactId>\n        </dependency>\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5728\u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u90ae\u4ef6\u53d1\u9001\u76f8\u5173\u7684\u914d\u7f6e\u5c5e\u6027")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"spring.mail.default-encoding=UTF-8\nspring.mail.host=\u90ae\u7bb1\u670d\u52a1\u5668\nspring.mail.username=\u5b8c\u6574\u7684\u90ae\u7bb1\u5730\u5740\nspring.mail.password=\u5bc6\u7801\nspring.mail.port=465\nspring.mail.properties.mail.smtp.auth=true\nspring.mail.properties.mail.smtp.connectiontimeout=5000\nspring.mail.properties.mail.smtp.timeout=3000\nspring.mail.properties.mail.smtp.writetimeout=5000\nspring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory\nspring.mail.properties.mail.smtp.socketFactory.fallback=false\nspring.mail.properties.mail.smtp.socketFactory.port=465\nspring.mail.properties.mail.smtp.starttls.enable=true\nspring.mail.properties.mail.smtp.starttls.required=true\n")),(0,r.kt)("p",null,"\u5982\u679c\u4e0d\u52a0\u5165\u4ee5\u4e0a\u914d\u7f6e\uff0c\u5728\u4f7f\u7528\u90ae\u4ef6\u9a8c\u8bc1\u7801\u65f6\u4f1a\u63d0\u793a \u3010\u9a8c\u8bc1\u7801\u5904\u7406\u5668\u4e0d\u5b58\u5728\u3011\uff0c\u4e14\u4e0d\u80fd\u6b63\u786e\u53d1\u9001\u90ae\u4ef6\u9a8c\u8bc1\u7801\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u3010\u6ce8\u610f\u3011\u5728\u963f\u91cc\u4e91ECS\u670d\u52a1\u5668\u4e0a\uff0c25\u7aef\u53e3\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u56e0\u6b64\u6700\u597d\u914d\u7f6e465\u7aef\u53e3")),(0,r.kt)("h3",{id:"\u5feb\u901f\u542f\u52a8"},"\u5feb\u901f\u542f\u52a8"),(0,r.kt)("p",null,"\u90ae\u4ef6\u9a8c\u8bc1\u7801\u7684\u53d1\u9001\u4ee3\u7801\u4e0e\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u53d1\u9001\u65b9\u6cd5\u57fa\u672c\u4e00\u81f4\uff0c\u53ea\u9700\u8981\u5c06",(0,r.kt)("inlineCode",{parentName:"p"},"CodeType.IMAGE"),"\u6539\u6210",(0,r.kt)("inlineCode",{parentName:"p"},"CodeType.EMAIL"),"\u5373\u53ef\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @GetMapping("/code/email")\n    @ResponseBody\n    public Response<String> email(HttpServletRequest request, HttpServletResponse response){\n        try {\n          codeProcessor.create(new ServletWebRequest(request, response),CodeType.EMAIL);\n        } catch (ValidateException e) {\n            return Response.error(e.getMessage());\n        }\n        return Response.suc();\n    }\n')),(0,r.kt)("p",null,"\u52a0\u5165\u4e0a\u8ff0\u914d\u7f6e\u4ee5\u540e\uff0c\u5373\u53ef\u901a\u8fc7"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"http://ip:port/code/email?email=\u76ee\u6807\u90ae\u7bb1\u5730\u5740")),(0,r.kt)("p",null,"\u53d1\u9001\u90ae\u7bb1\u9a8c\u8bc1\u7801\u4e86\u3002"),(0,r.kt)("h3",{id:"\u6821\u9a8c\u9a8c\u8bc1\u7801"},"\u6821\u9a8c\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @GetMapping("/email/validate")\n    @ResponseBody\n    public Response<String> validate(HttpServletRequest request, HttpServletResponse response){\n        try {\n        codeProcessor.validate(new ServletWebRequest(request, response),CodeType.EMAIL);\n        } catch (ValidateException e) {\n            return Response.error(e.getMessage());\n        }\n        return Response.suc();\n    }\n')),(0,r.kt)("p",null,"\u52a0\u5165\u4e0a\u8ff0\u914d\u7f6e\u4ee5\u540e\uff0c\u5373\u53ef\u901a\u8fc7"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"http://ip:port/email/validate?email=\u76ee\u6807\u90ae\u7bb1\u5730\u5740&email_code=\u9a8c\u8bc1\u7801")),(0,r.kt)("p",null,"\u6765\u9a8c\u8bc1\u4e86\u3002"),(0,r.kt)("h3",{id:"\u914d\u7f6e\u53c2\u6570-1"},"\u914d\u7f6e\u53c2\u6570"),(0,r.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0c\u7ec4\u4ef6\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u989d\u5916\u7684\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"#\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6\u90ae\u4ef6\u9a8c\u8bc1\u7801\u7684\u90ae\u7bb1\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a email\nyishuifengxiao.code.email.code-key=email\n#\u8bf7\u6c42\u4e2d\u83b7\u53d6\u90ae\u4ef6\u9a8c\u8bc1\u7801\u5bf9\u5e94\u7684\u503c\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a email_code\nyishuifengxiao.code.email.code-value=email_code\n#\u9a8c\u8bc1\u7801\u662f\u5426\u5305\u542b\u5b57\u6bcd,\u9ed8\u8ba4\u5305\u542b\nyishuifengxiao.code.email.contain-letter=true\n#\u9a8c\u8bc1\u7801\u662f\u5426\u5305\u542b\u6570\u5b57,\u9ed8\u8ba4\u5305\u542b\nyishuifengxiao.code.email.contain-number=true\n#\u9a8c\u8bc1\u7801\u90ae\u7bb1\u7684\u5185\u5bb9\u6a21\u677f\uff0c\u9ed8\u8ba4\u503c\u4e3a \u60a8\u7684\u9a8c\u8bc1\u7801\u7684\u5185\u5bb9\u4e3a{0} ,\u9a8c\u8bc1\u7801\u7684\u6709\u6548\u65f6\u95f4\u4e3a {1} \u79d2\nyishuifengxiao.code.email.content-template=\u60a8\u7684\u9a8c\u8bc1\u7801\u7684\u5185\u5bb9\u4e3a{0} ,\u9a8c\u8bc1\u7801\u7684\u6709\u6548\u65f6\u95f4\u4e3a {1} \u79d2\n#\u9a8c\u8bc1\u7801\u7684\u5931\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba4\u4e3a300s\nyishuifengxiao.code.email.expire-in=300\n#\u9a8c\u8bc1\u7801\u7684\u957f\u5ea6,\u9ed8\u8ba4\u4e3a4\nyishuifengxiao.code.email.length=4\n#\u9a8c\u8bc1\u7801\u90ae\u7bb1\u7684\u6807\u9898\uff0c\u9ed8\u8ba4\u503c\u4e3a \u5e10\u53f7\u4fdd\u62a4\u9a8c\u8bc1\nyishuifengxiao.code.email.title=\u5e10\u53f7\u4fdd\u62a4\u9a8c\u8bc1\n")),(0,r.kt)("p",null,"\u7c7b\u4f3c\u5730\uff0c\u4ece\u8bf7\u6c42\u53c2\u6570\u4e2d\u83b7\u53d6\u9700\u8981\u53d1\u9001\u7684\u76ee\u6807\u90ae\u7bb1",(0,r.kt)("inlineCode",{parentName:"p"},"email"),"\u7684\u53c2\u6570\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.email.code-key"),"\u5c5e\u6027,\u9a8c\u8bc1\u7801\u5185\u5bb9",(0,r.kt)("inlineCode",{parentName:"p"},"email_code"),"\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.email.code-value"),"\u5c5e\u6027\u51b3\u5b9a\u3002"),(0,r.kt)("h3",{id:"\u53d1\u9001\u90ae\u4ef6"},"\u53d1\u9001\u90ae\u4ef6"),(0,r.kt)("p",null,"\u5728\u90ae\u4ef6\u9a8c\u8bc1\u7801\u529f\u80fd\u4e2d\uff0c\u7ec4\u4ef6\u5bf9\u90ae\u7bb1\u9a8c\u8bc1\u7801\u505a\u4e86\u4e00\u4e2a\u7f3a\u7701\u6027\u5b9e\u73b0\uff0c\u5728\u7528\u6237\u5bf9\u90ae\u4ef6\u9a8c\u8bc1\u7801\u7684\u683c\u5f0f\u6709\u81ea\u5b9a\u4e49\u9700\u6c42\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728spring\u4e2d\u6ce8\u5165\u4e00\u4e2a\u540d\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"emailCodeSender"),"\u7684\u5b9e\u4f8b\u6765\u5b9e\u73b0\u81ea\u5df1\u7684\u6a21\u677f\u5185\u5bb9\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component("emailCodeSender")\npublic class EmailCodeSender implements CodeSender  {\n    \n    @Override\n    public <T extends ValidateCode> void send(ServletWebRequest request, String target, T code){\n        //\u5b9e\u73b0\u81ea\u5df1\u7684\u53d1\u9001\u903b\u8f91\n        //\u6b64\u5904\u7684target\u503c\u4e3a\u76ee\u6807\u90ae\u7bb1\u5730\u5740\n    }\n}\n')),(0,r.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801-1"},"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u9488\u5bf9\u4e8e\u56fe\u5f62\u9a8c\u8bc1\u7801\uff0c\u7ec4\u4ef6\u5bf9\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u751f\u6210\u505a\u4e00\u4e2a\u9ed8\u8ba4\u5b9e\u73b0\uff0c\u5982\u679c\u751f\u6210\u7684\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u5185\u5bb9\u4e0d\u6ee1\u8db3\u7528\u6237\u9700\u8981\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"emailCodeGenerator"),"\u7684\u5b9e\u4f8b\u6ce8\u5165\u5230spring\u4e2d\u5373\u53ef\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component("emailCodeGenerator")\npublic class EmailCodeGenerator implements CodeGenerator{\n    \n    @Override\n    public ValidateCode generate(ServletWebRequest servletWebRequest){\n      //\u5b9e\u73b0\u81ea\u5df1\u7684\u90ae\u4ef6\u9a8c\u8bc1\u7801\u7684\u751f\u6210\u903b\u8f91  \n    }\n}\n')),(0,r.kt)("h2",{id:"\u56db-\u77ed\u4fe1\u9a8c\u8bc1\u7801"},"\u56db \u77ed\u4fe1\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u7531\u4e8e\u77ed\u4fe1\u9a8c\u8bc1\u7801\u7684\u7279\u6b8a\u6027\uff0c\u4e0d\u540c\u7684\u77ed\u4fe1\u63d0\u4f9b\u5546\u6709\u4e0d\u540c\u7684\u53d1\u9001\u63a5\u53e3\uff0c\u56e0\u6b64\u5728\u4f7f\u7528\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd\u4e4b\u524d\uff0c\u9700\u8981\u5b8c\u6210\u81ea\u5df1\u7684\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"smsCodeSender"),"\u77ed\u4fe1\u53d1\u9001\u5668,\u5e76\u5c06\u5176\u6ce8\u5165\u5230spring\u4e0a\u4e0b\u6587\u4e4b\u4e2d\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component("smsCodeSender")\npublic class SmsCodeSender implements CodeSender {\n    \n    @Override\n    public <T extends ValidateCode> void send(ServletWebRequest request, String target, T code){\n        //\u5b9e\u73b0\u81ea\u5df1\u7684\u53d1\u9001\u903b\u8f91\n        //target \u4e3a\u76ee\u6807\u624b\u673a\u53f7\u7801\n    }\n}\n')),(0,r.kt)("h3",{id:"\u5feb\u9012\u542f\u52a8"},"\u5feb\u9012\u542f\u52a8"),(0,r.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @GetMapping("/code/sms")\n    @ResponseBody\n    public Response<String> sms(HttpServletRequest request, HttpServletResponse response){\n        try {\n            codeProcessor.create(new ServletWebRequest(request, response),CodeType.SMS);\n        } catch (ValidateException e) {\n            return Response.error(e.getMessage());\n        }\n        return Response.suc();\n    }\n')),(0,r.kt)("p",null,"\u52a0\u5165\u4e0a\u8ff0\u914d\u7f6e\u4ee5\u540e\uff0c\u5373\u53ef\u901a\u8fc7"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"http://ip:port/code/sms?phone=\u76ee\u6807\u624b\u673a\u53f7")),(0,r.kt)("p",null,"\u53d1\u9001\u90ae\u7bb1\u9a8c\u8bc1\u7801\u4e86\u3002"),(0,r.kt)("h3",{id:"\u6821\u9a8c\u9a8c\u8bc1\u7801-1"},"\u6821\u9a8c\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @GetMapping("/sms/validate")\n    @ResponseBody\n    public Response<String> validate(HttpServletRequest request, HttpServletResponse response){\n        try {\n       codeProcessor.validate(new ServletWebRequest(request, response),CodeType.SMS);\n        } catch (ValidateException e) {\n            return Response.error(e.getMessage());\n        }\n        return Response.suc();\n    }\n')),(0,r.kt)("p",null,"\u52a0\u5165\u4e0a\u8ff0\u914d\u7f6e\u4ee5\u540e\uff0c\u5373\u53ef\u901a\u8fc7"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"http://ip:port/sms/validate?phone=\u76ee\u6807\u624b\u673a\u53f7&phone_code=\u9a8c\u8bc1\u7801")),(0,r.kt)("p",null,"\u6765\u9a8c\u8bc1\u4e86\u3002"),(0,r.kt)("h3",{id:"\u53c2\u6570\u914d\u7f6e"},"\u53c2\u6570\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"#\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\u7684\u53d1\u9001\u76ee\u6807(\u624b\u673a\u53f7)\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a phone\nyishuifengxiao.code.sms.code-key=phone\n#\u8bf7\u6c42\u4e2d\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5bf9\u5e94\u7684\u77ed\u4fe1\u5185\u5bb9\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a phone_code\nyishuifengxiao.code.sms.code-value=phone_code\n#\u9a8c\u8bc1\u7801\u662f\u5426\u5305\u542b\u5b57\u6bcd,\u9ed8\u8ba4\u5305\u542b\nyishuifengxiao.code.sms.contain-letter=true\n#\u9a8c\u8bc1\u7801\u662f\u5426\u5305\u542b\u6570\u5b57,\u9ed8\u8ba4\u5305\u542b\nyishuifengxiao.code.sms.contain-number=true\n#\u9a8c\u8bc1\u7801\u7684\u5931\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba4\u4e3a300s\nyishuifengxiao.code.sms.expire-in=300\n#\u9a8c\u8bc1\u7801\u7684\u957f\u5ea6,\u9ed8\u8ba4\u4e3a4\nyishuifengxiao.code.sms.length=4\n")),(0,r.kt)("p",null,"\u7c7b\u4f3c\u5730\uff0c\u4ece\u8bf7\u6c42\u53c2\u6570\u4e2d\u83b7\u53d6\u77ed\u4fe1\u53d1\u9001\u76ee\u6807\u7684\u624b\u673a\u53f7",(0,r.kt)("inlineCode",{parentName:"p"},"phone"),"\u53c2\u6570\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.sms.code-key"),"\u5c5e\u6027,",(0,r.kt)("inlineCode",{parentName:"p"},"phone_code"),"\u53c2\u6570\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.sms.code-value"),"\u5c5e\u6027\u51b3\u5b9a\u3002"),(0,r.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801-2"},"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u9488\u5bf9\u4e8e\u56fe\u5f62\u9a8c\u8bc1\u7801\uff0c\u7ec4\u4ef6\u5bf9\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u751f\u6210\u505a\u4e00\u4e2a\u9ed8\u8ba4\u5b9e\u73b0\uff0c\u5982\u679c\u751f\u6210\u7684\u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u5185\u5bb9\u4e0d\u6ee1\u8db3\u7528\u6237\u9700\u8981\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"smsCodeGenerator"),"\u7684\u5b9e\u4f8b\u6ce8\u5165\u5230spring\u4e2d\u5373\u53ef\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component("smsCodeGenerator")\npublic class SmsCodeGenerator implements CodeGenerator{\n    \n    @Override\n    public SmsCode generate(ServletWebRequest servletWebRequest){\n      //\u5b9e\u73b0\u81ea\u5df1\u7684\u77ed\u4fe1\u9a8c\u8bc1\u7801\u7684\u751f\u6210\u903b\u8f91  \n    }\n}\n')),(0,r.kt)("h2",{id:"\u4e94-\u8fdb\u9636\u4f7f\u7528"},"\u4e94 \u8fdb\u9636\u4f7f\u7528"),(0,r.kt)("h3",{id:"\u5b58\u50a8\u9a8c\u8bc1\u7801\u5230redis"},"\u5b58\u50a8\u9a8c\u8bc1\u7801\u5230Redis"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5f53\u7cfb\u7edf\u4e2d\u914d\u7f6e\u6709Redis\u65f6\uff0c\u7ec4\u4ef6\u9ed8\u8ba4\u662f\u4f1a\u5c06\u9a8c\u8bc1\u7801\u5b58\u50a8\u5230Redis\u4e2d")),(0,r.kt)("p",null,"\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9a8c\u8bc1\u7801\u662f\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"DefaultCodeRepository"),"\u5b8c\u6210\u7684\u4e00\u4e2a\u9ed8\u8ba4\u7684\u5b9e\u73b0\u3002\u4f46\u662f\u5728\u96c6\u7fa4\u6216\u5206\u5e03\u5f0f\u60c5\u51b5\u4e0b\uff0c\u6b64\u65b9\u5f0f\u663e\u7136\u662f\u4e0d\u5408\u9002\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u52a0\u5165redis\uff0c\u5c06\u9a8c\u8bc1\u7801\u5b58\u50a8\u5728redis\u4e4b\u4e2d\u3002"),(0,r.kt)("p",null,"\u5177\u4f53\u5b9e\u73b0\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,"1 \u5728\u9879\u76ee\u4e2d\u52a0\u5165redis\u76f8\u5173\u7684\u4f9d\u8d56"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n")),(0,r.kt)("p",null,"2 \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165redis\u76f8\u5173\u7684\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"spring.redis.host=redis\u6570\u636e\u5e93\nspring.redis.password=redis\u6570\u636e\u5e93\u5bc6\u7801\nspring.redis.port=redis\u6570\u636e\u5e93\u7aef\u53e3\n")),(0,r.kt)("p",null,"\u5728\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u7ec4\u4ef6\u4f1a\u9ed8\u8ba4\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"RedisCodeRepository"),"\u6765\u7ba1\u7406\u9a8c\u8bc1\u7801\u7684\u5b58\u53d6\u3002"),(0,r.kt)("p",null,"\u603b\u7684\u6765\u8bf4\uff0c\u7ec4\u4ef6\u4f1a\u81ea\u52a8\u5224\u65ad\u7cfb\u7edf\u4e2d\u6709\u65e0redis\u76f8\u5173\u7684\u5b9e\u4f8b\u52a0\u8f7d\u4fe1\u606f\uff0c\u5982\u679c\u7cfb\u7edf\u4e2d\u5b58\u5728redis\uff0c\u4f1a\u9ed8\u8ba4\u4f7f\u7528redis\u8fdb\u884c\u9a8c\u8bc1\u7801\u7ba1\u7406\u3002"),(0,r.kt)("p",null,"\u5728\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"RedisCodeRepository"),"\u8fdb\u884c\u9a8c\u8bc1\u7801\u7ba1\u7406\u540e\uff0credis\u6570\u636e\u5e93\u4f1a\u5728\u6709\u9a8c\u8bc1\u7801\u751f\u6210\u65f6\u4ea7\u751f\u4e00\u4e2akey\u7684\u524d\u7f00\u4e3a  ",(0,r.kt)("inlineCode",{parentName:"p"},"validate_code_"),"\u7684\u8bb0\u5f55\uff0c\u6b64\u8bb0\u5f55\u4fe1\u606f\u4f1a\u88ab\u81ea\u52a8\u6e05\u7406\uff0c\u8bf7\u52ff\u624b\u52a8\u5220\u9664\u8be5\u8bb0\u5f55\uff0c\u5426\u5219\u4f1a\u5f71\u54cd\u9a8c\u8bc1\u7801\u7ec4\u4ef6\u7684\u529f\u80fd\u3002"),(0,r.kt)("p",null,"\u5f00\u542f\u9a8c\u8bc1\u7801\u529f\u80fd\u540e\uff0c\u7ec4\u4ef6\u4f1a\u5c06\u9a8c\u8bc1\u7801\u5bf9\u8c61\u4ee5\u524d\u7f00",(0,r.kt)("inlineCode",{parentName:"p"},"validate_code_"),"+\u552f\u4e00\u6807\u8bc6\u7b26\u4e3a\u952e\u5b58\u50a8\u5230Redis\u4e2d\u3002\u5176\u952e\u7684\u5f62\u5f0f\u4e3a:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"validate_code_store_redis:{\u552f\u4e00\u6807\u8bc6\u7b26}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e\u56fe\u5f62\u9a8c\u8bc1\u7801\uff0c\u5176\u552f\u4e00\u6807\u8bc6\u7b26\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.image.code-key"),"\u7684\u503c\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6\u800c\u6765")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e\u90ae\u4ef6\u9a8c\u8bc1\u7801\uff0c\u5176\u552f\u4e00\u6807\u8bc6\u7b26\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.email.code-key"),"\u7684\u503c\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6\u800c\u6765\uff0c\u4e00\u822c\u4e3a\u53d1\u9001\u76ee\u6807\u90ae\u7bb1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff0c\u5176\u552f\u4e00\u6807\u8bc6\u7b26\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"yishuifengxiao.code.sms.code-key"),"\u7684\u503c\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6\u800c\u6765,\u4e00\u822c\u4e3a\u76ee\u6807\u624b\u673a\u53f7"))))}c.isMDXComponent=!0}}]);