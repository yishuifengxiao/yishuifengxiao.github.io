"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1515],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=r.createContext({}),c=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},l=function(e){var t=c(e.components);return r.createElement(u.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},y=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,u=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=c(n),y=i,m=p["".concat(u,".").concat(y)]||p[y]||d[y]||a;return n?r.createElement(m,o(o({ref:t},l),{},{components:n})):r.createElement(m,o({ref:t},l))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=y;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s[p]="string"==typeof e?e:i,o[1]=s;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}y.displayName="MDXCreateElement"},96792:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var r=n(87462),i=(n(67294),n(3905));const a={sidebar_position:2,title:"\u57fa\u7840\u914d\u7f6e"},o=void 0,s={unversionedId:"security/security_config",id:"security/security_config",title:"\u57fa\u7840\u914d\u7f6e",description:"\u4e00 \u6838\u5fc3\u914d\u7f6e",source:"@site/wiki/common-starter/security/security_config.md",sourceDirName:"security",slug:"/security/security_config",permalink:"/common-starter/security/security_config",draft:!1,tags:[],version:"current",lastUpdatedBy:"yishuifengxiao",lastUpdatedAt:1676270727,formattedLastUpdatedAt:"2023\u5e742\u670813\u65e5",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"\u57fa\u7840\u914d\u7f6e"},sidebar:"tutorialSidebar",previous:{title:"\u5feb\u901f\u5165\u95e8",permalink:"/common-starter/security/"},next:{title:"\u65b0\u7248\u672c\u53d8\u5316",permalink:"/common-starter/security/new_version"}},u={},c=[{value:"\u4e00 \u6838\u5fc3\u914d\u7f6e",id:"\u4e00-\u6838\u5fc3\u914d\u7f6e",level:2},{value:"\u4e8c \u8d44\u6e90\u7ba1\u7406",id:"\u4e8c-\u8d44\u6e90\u7ba1\u7406",level:2},{value:"2.1 \u5ffd\u89c6\u8d44\u6e90",id:"21-\u5ffd\u89c6\u8d44\u6e90",level:3},{value:"2.2 \u533f\u540d\u8d44\u6e90",id:"22-\u533f\u540d\u8d44\u6e90",level:3},{value:"2.3 permitAll\u8d44\u6e90",id:"23-permitall\u8d44\u6e90",level:3},{value:"2.4 \u81ea\u5b9a\u4e49\u6388\u6743\u8d44\u6e90",id:"24-\u81ea\u5b9a\u4e49\u6388\u6743\u8d44\u6e90",level:3},{value:"\u4e09 \u57fa\u7840\u914d\u7f6e",id:"\u4e09-\u57fa\u7840\u914d\u7f6e",level:2},{value:"2.1 \u7b80\u5355\u4f7f\u7528",id:"21-\u7b80\u5355\u4f7f\u7528",level:3},{value:"2.1.1 \u751f\u6210token",id:"211-\u751f\u6210token",level:4},{value:"2.1.2 \u4f7f\u7528token",id:"212-\u4f7f\u7528token",level:4},{value:"2.2 \u8fdb\u9636\u4f7f\u7528",id:"22-\u8fdb\u9636\u4f7f\u7528",level:3},{value:"2.2.1 \u57fa\u7840\u8fdb\u9636",id:"221-\u57fa\u7840\u8fdb\u9636",level:4},{value:"2.2.2 \u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55",id:"222-\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55",level:4},{value:"2.2.3 \u9a8c\u8bc1\u7801\u4f7f\u7528",id:"223-\u9a8c\u8bc1\u7801\u4f7f\u7528",level:4},{value:"2.3 \u9ad8\u7ea7\u4f7f\u7528",id:"23-\u9ad8\u7ea7\u4f7f\u7528",level:3},{value:"2.3.1 \u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668",id:"231-\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668",level:4},{value:"2.3.2 \u81ea\u5b9a\u4e49\u6388\u6743\u914d\u7f6e",id:"232-\u81ea\u5b9a\u4e49\u6388\u6743\u914d\u7f6e",level:4},{value:"2.3.3 token\u751f\u6210\u5de5\u5177",id:"233-token\u751f\u6210\u5de5\u5177",level:4}],l={toc:c},p="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"\u4e00-\u6838\u5fc3\u914d\u7f6e"},"\u4e00 \u6838\u5fc3\u914d\u7f6e"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u662f\u5426\u663e\u793a\u52a0\u8f7d\u65e5\u5fd7\uff0c\u9ed8\u8ba4\u4e3afalse\nyishuifengxiao.security.show-detail=false\n#\u9700\u8981\u5220\u9664\u7684cookie\u7684\u540d\u5b57 JSESSIONI\nyishuifengxiao.security.cookie-name=JSESSIONI\n#\u662f\u5426\u5f00\u542fhttpBasic\u8bbf\u95ee\uff0c\u9ed8\u8ba4\u4e3atrue\nyishuifengxiao.security.http-basic=true\n#the HTTP Basic realm to use ,default value is yishui\nyishuifengxiao.security.realm-name=yishui\n#\u8868\u5355\u767b\u9646\u65f6form\u8868\u5355\u8bf7\u6c42\u7684\u5730\u5740\uff0c\u9ed8\u8ba4\u4e3a/web/login\nyishuifengxiao.security.form-action-url=/web/login\n#\u8868\u5355\u63d0\u4ea4\u65f6\u9ed8\u8ba4\u7684\u7528\u6237\u540d\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a username\nyishuifengxiao.security.username-parameter=username\n#\u8868\u5355\u63d0\u4ea4\u65f6\u9ed8\u8ba4\u7684\u5bc6\u7801\u540d\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a password\nyishuifengxiao.security.password-parameter=password\n#\u7cfb\u7edf\u767b\u9646\u9875\u9762\u7684\u5730\u5740 ,\u9ed8\u8ba4\u4e3a /toLogin\nyishuifengxiao.security.login-page=/toLogin\n#\u9ed8\u8ba4\u7684\u5904\u7406\u767b\u5f55\u6210\u529f\u540e\u8df3\u8f6c\u7684URL\u7684\u8def\u5f84 \uff0c\u9ed8\u8ba4\u4e3a/index\nyishuifengxiao.security.login-success-url=/index\n#\u9ed8\u8ba4\u7684\u5904\u7406\u767b\u5f55\u5931\u8d25\u540e\u8df3\u8f6c\u7684URL\u7684\u8def\u5f84 \uff0c\u9ed8\u8ba4\u4e3a/toLogin\nyishuifengxiao.security.login-fail-url=/toLogin\n#\u9ed8\u8ba4\u7684\u5904\u7406\u767b\u51fa\u8bf7\u6c42\u7684URL\u7684\u8def\u5f84\u3010\u5373\u8bf7\u6c42\u6b64URL\u5373\u4e3a\u9000\u51fa\u64cd\u4f5c\u3011\uff0c\u9ed8\u8ba4\u4e3a/logout\nyishuifengxiao.security.login-out-url=/logout\n#\u6743\u9650\u62e6\u622a\u65f6\u9ed8\u8ba4\u7684\u8df3\u8f6c\u5730\u5740\uff0c\u9ed8\u8ba4\u4e3a /toLogin\nyishuifengxiao.security.redirect-url=/toLogin\n#\u5173\u95edcsrf\u529f\u80fd,\u9ed8\u8ba4\u4e3atrue\nyishuifengxiao.security.close-csrf=true\n# \u662f\u5426\u5173\u95edcors\u4fdd\u62a4\uff0c\u9ed8\u8ba4\u4e3afalse\nyishuifengxiao.security.close-cors=false\n#\u662f\u5426\u5f00\u542ftoken\u5408\u6cd5\u884c\u6821\u9a8c,\u9ed8\u8ba4\u4e3a\u5f00\u542f\nyishuifengxiao.security.open-token-filter=true\n# \u662f\u5426\u5173\u95ed\u524d\u7f6e\u53c2\u6570\u9a8c\u8bc1,\u9ed8\u8ba4\u4e3afalse\nyishuifengxiao.security.close-pre-auth=false\n#\u52a0\u89e3\u5bc6\u4e2d\u9700\u8981\u4f7f\u7528\u7684\u5bc6\u94a5\nyishuifengxiao.security.secret-key=aa\n###\n###\n###\n#\u8bb0\u4f4f\u6211\u4ea7\u751f\u7684token\uff0c\u9ed8\u8ba4\u4e3a yishuifengxiao\nyishuifengxiao.security.remeber-me.key=yishuifengxiao\n#\u767b\u9646\u65f6\u5f00\u542f\u8bb0\u4f4f\u6211\u7684\u53c2\u6570,\u9ed8\u8ba4\u4e3a rememberMe\nyishuifengxiao.security.remeber-me.remember-me-parameter=rememberMe\n#\u9ed8\u8ba4\u8fc7\u671f\u65f6\u95f4\u4e3a60\u5206\u949f,\u5355\u4f4d\u4e3a\u79d2\nyishuifengxiao.security.remeber-me.remember-me-seconds=3600\n#\u662f\u5426\u4f7f\u7528\u5b89\u5168cookie\nyishuifengxiao.security.remeber-me.use-secure-cookie=true\n")),(0,i.kt)("h2",{id:"\u4e8c-\u8d44\u6e90\u7ba1\u7406"},"\u4e8c \u8d44\u6e90\u7ba1\u7406"),(0,i.kt)("h3",{id:"21-\u5ffd\u89c6\u8d44\u6e90"},"2.1 \u5ffd\u89c6\u8d44\u6e90"),(0,i.kt)("p",null,"\u5141\u8bb8\u6dfb\u52a0SpringSecurity\u5e94\u5ffd\u7565\u7684RequestMatcher\u5b9e\u4f8b\u3002Spring Security\u63d0\u4f9b\u7684Web\u5b89\u5168\uff08\u5305\u62ecSecurityContext\uff09\u5728\u5339\u914d\u7684HttpServletRequest\u4e0a\u4e0d\u53ef\u7528\u3002\u901a\u5e38\uff0c\u6ce8\u518c\u7684\u8bf7\u6c42\u5e94\u8be5\u662f\u9759\u6001\u8d44\u6e90\u7684\u8bf7\u6c42\u3002\u5bf9\u4e8e\u52a8\u6001\u8bf7\u6c42\uff0c\u8bf7\u8003\u8651\u5c06\u8bf7\u6c42\u6620\u5c04\u4e3a\u5141\u8bb8\u6240\u6709\u7528\u6237\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u6240\u6709\u9700\u8981\u5ffd\u89c6\u7684\u76ee\u5f55,\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u91c7\u7528 ant \u98ce\u683c\uff0c\u591a\u4e2a\u8d44\u6e90\u4e4b\u95f4\u91c7\u7528\u534a\u89d2\u9017\u53f7\u5206\u5272\nyishuifengxiao.security.resource.ignore.urls[0]=/aaa,/bb\nyishuifengxiao.security.resource.ignore.urls[1]=/ccc,/dd\n#\u662f\u5426\u5305\u542bactuator\u76f8\u5173\u7684\u8def\u5f84,\u9ed8\u8ba4\u4e3atrue\nyishuifengxiao.security.resource.ignore.contain-actuator=true\n#\u662f\u5426\u5305\u542b\u6240\u6709\u7684\u8d44\u6e90,\u9ed8\u8ba4\u4e3afalse\nyishuifengxiao.security.resource.ignore.contain-all=false\n# \u662f\u5426\u5305\u542b\u9519\u8bef\u9875\u9762\u76f8\u5173\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3a\u5305\u542b\nyishuifengxiao.security.resource.ignore.contain-error-page=true\n#\u662f\u5426\u9ed8\u8ba4\u5305\u542b\u9759\u6001\u8d44\u6e90 ,\u9ed8\u8ba4\u4e3atrue\nyishuifengxiao.security.resource.ignore.contain-static-resource=true\n#\u662f\u5426\u5305\u542bswagger-ui\u7684\u8d44\u6e90 ,\u9ed8\u8ba4\u4e3atrue\nyishuifengxiao.security.resource.ignore.contain-swagger-ui-resource=true\n#\u662f\u5426\u5305\u542bwebJars\u8d44\u6e90,\u9ed8\u8ba4\u4e3atrue\nyishuifengxiao.security.resource.ignore.contain-webjars=true\n")),(0,i.kt)("h3",{id:"22-\u533f\u540d\u8d44\u6e90"},"2.2 \u533f\u540d\u8d44\u6e90"),(0,i.kt)("p",null,"\u6307\u5b9a\u533f\u540d\u7528\u6237\u5141\u8bb8URL\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u6240\u6709\u7684\u6307\u5b9a\u533f\u540d\u7528\u6237\u5141\u8bb8URL,\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u91c7\u7528 ant \u98ce\u683c\uff0c\u591a\u4e2a\u8d44\u6e90\u4e4b\u95f4\u91c7\u7528\u534a\u89d2\u9017\u53f7\u5206\u5272\nyishuifengxiao.security.resource.anonymous[0]=/aaa,/bb\nyishuifengxiao.security.resource.anonymous[1]=/ccc,/dd\n")),(0,i.kt)("h3",{id:"23-permitall\u8d44\u6e90"},"2.3 permitAll\u8d44\u6e90"),(0,i.kt)("p",null,"\u6307\u5b9a\u4efb\u4f55\u4eba\u90fd\u5141\u8bb8URL\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u6240\u6709\u7684\u6307\u5b9a\u4efb\u4f55\u4eba\u90fd\u5141\u8bb8URL\u3002,\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u91c7\u7528 ant \u98ce\u683c\uff0c\u591a\u4e2a\u8d44\u6e90\u4e4b\u95f4\u91c7\u7528\u534a\u89d2\u9017\u53f7\u5206\u5272\nyishuifengxiao.security.resource.permits[0]=/aaa,/bb\nyishuifengxiao.security.resource.permits[1]=/ccc,/dd\n")),(0,i.kt)("h3",{id:"24-\u81ea\u5b9a\u4e49\u6388\u6743\u8d44\u6e90"},"2.4 \u81ea\u5b9a\u4e49\u6388\u6743\u8d44\u6e90"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u6240\u6709\u7684\u81ea\u5b9a\u4e49\u6743\u9650\u7684\u8d44\u6e90\u3002,\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u91c7\u7528 ant \u98ce\u683c\uff0c\u591a\u4e2a\u8d44\u6e90\u4e4b\u95f4\u91c7\u7528\u534a\u89d2\u9017\u53f7\u5206\u5272\nyishuifengxiao.security.resource.customs[0]=/aaa,/bb\nyishuifengxiao.security.resource.customs[1]=/ccc,/dd\n")),(0,i.kt)("p",null,"\u5728\u8fdb\u884c\u81ea\u5b9a\u4e49\u6388\u6743\u8d44\u6e90\uff0c\u9700\u8981\u5728\u9879\u76ee\u4e2d\u914d\u7f6e\u4e00\u4e2a\u540d\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"customResourceProvider"),"\u7684com.yishuifengxiao.common.security.httpsecurity.authorize.custom.CustomResourceProvider\u5b9e\u4f8b\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@Component("customResourceProvider")\npublic class SimpleCustomResourceProvider implements CustomResourceProvider {\n   @Override\n   public boolean hasPermission(HttpServletRequest request, Authentication auth) {\n      log.debug("\u3010\u81ea\u5b9a\u4e49\u6388\u6743\u3011\u81ea\u5b9a\u4e49\u6388\u6743\u7684\u8def\u5f84\u4e3a {}\uff0c\u8ba4\u8bc1\u4fe1\u606f\u4e3a {}  ", request.getRequestURI(), auth);\n\n      return true;\n   }\n\n}\n')),(0,i.kt)("h2",{id:"\u4e09-\u57fa\u7840\u914d\u7f6e"},"\u4e09 \u57fa\u7840\u914d\u7f6e"),(0,i.kt)("h3",{id:"21-\u7b80\u5355\u4f7f\u7528"},"2.1 \u7b80\u5355\u4f7f\u7528"),(0,i.kt)("h4",{id:"211-\u751f\u6210token"},"2.1.1 \u751f\u6210token"),(0,i.kt)("p",null,"\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7ec4\u4ef6\u4f1a\u6839\u636e\u8bf7\u6c42\u5224\u65ad\u662f\u5426\u8bf7\u6c42\u7684\u7c7b\u578b\uff0c\u5f53\u8bf7\u6c42\u4e3ajson\u7c7b\u578b\u7684\u8bf7\u6c42\u65f6\u76f4\u63a5\u8f93\u51fa\u5bf9\u5e94\u7684\u4fe1\u606f\uff0c\u5426\u5219\u4f1a\u91cd\u5b9a\u5411\u5230\u914d\u7f6e\u7684\u8def\u5f84\u3002\u5176\u4e2d\u91cd\u5b9a\u5411\u7684\u8def\u5f84\u7684\u914d\u7f6e\u5982\u4e0b:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u7cfb\u7edf\u767b\u9646\u9875\u9762\u7684\u5730\u5740 ,\u9ed8\u8ba4\u4e3a /toLogin\nyishuifengxiao.security.login-page=/toLogin\n#\u9ed8\u8ba4\u7684\u5904\u7406\u767b\u5f55\u6210\u529f\u540e\u8df3\u8f6c\u7684URL\u7684\u8def\u5f84 \uff0c\u9ed8\u8ba4\u4e3a/index\nyishuifengxiao.security.login-success-url=/index\n#\u9ed8\u8ba4\u7684\u5904\u7406\u767b\u5f55\u5931\u8d25\u540e\u8df3\u8f6c\u7684URL\u7684\u8def\u5f84 \uff0c\u9ed8\u8ba4\u4e3a/toLogin\nyishuifengxiao.security.login-fail-url=/toLogin\n#\u9ed8\u8ba4\u7684\u5904\u7406\u767b\u51fa\u8bf7\u6c42\u7684URL\u7684\u8def\u5f84\u3010\u5373\u8bf7\u6c42\u6b64URL\u5373\u4e3a\u9000\u51fa\u64cd\u4f5c\u3011\uff0c\u9ed8\u8ba4\u4e3a/logout\nyishuifengxiao.security.login-out-url=/logout\n#\u6743\u9650\u62e6\u622a\u65f6\u9ed8\u8ba4\u7684\u8df3\u8f6c\u5730\u5740\uff0c\u9ed8\u8ba4\u4e3a /toLogin\nyishuifengxiao.security.redirect-url=/toLogin\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8bf7\u6c42\u4e3aget,\u4e14\u8bf7\u6c42\u5934Accept\u548ccontentType\u5747\u4e0d\u5305\u542bjson\u5173\u952e\u5b57\u65f6\u5224\u65ad\u4e3a\u975ejson\u7c7b\u578b\u8bf7\u6c42\uff0c\u5176\u4ed6\u60c5\u51b5\u4e0b\u5747\u4e3ajson\u7c7b\u578b\u8bf7\u6c42\u3002")),(0,i.kt)("p",null,"\u8ba4\u8bc1\u8bf7\u6c42"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl --location --request POST 'http://localhost:8080/web/login' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--header 'Cookie: JSESSIONID=01A5676011D341C3BF8BC2E78A0E402A' \\\n--data-urlencode 'username=zhangsan' \\\n--data-urlencode 'password=12345678'\n")),(0,i.kt)("p",null,"\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8ba4\u8bc1\u6210\u529f\u540e\uff0c\u8f93\u51fa\u7684\u7528\u6237\u4fe1\u606f\u4e3a\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "code": 200,\n    "msg": "\u8ba4\u8bc1\u6210\u529f",\n    "requtest-id": "14b1d5e7ad2a4641b5a195691e07f28c",\n    "data": {\n        "authorities": [],\n        "details": null,\n        "authenticated": true,\n        "value": "60C45471AF39D9C3726150DEF5513E69184205C922B4670E4EB79EB3748E6F585F06ADCA94688AE406DFE549FF29E182A831DDC995A98489",\n        "username": "zhangsan",\n        "sessionId": "01A5676011D341C3BF8BC2E78A0E402A",\n        "validSeconds": 86400,\n        "time": "2023-02-10 16:51:45",\n        "expireAt": "2023-02-11 16:51:45",\n        "name": null,\n        "active": true,\n        "expired": false,\n        "principal": "60C45471AF39D9C3726150DEF5513E69184205C922B4670E4EB79EB3748E6F585F06ADCA94688AE406DFE549FF29E182A831DDC995A98489",\n        "credentials": "60C45471AF39D9C3726150DEF5513E69184205C922B4670E4EB79EB3748E6F585F06ADCA94688AE406DFE549FF29E182A831DDC995A98489"\n    },\n    "response-time": "2023-02-10 16:51:45"\n}\n')),(0,i.kt)("p",null,"\u5176\u4e2d\u7684value\u5373\u4e3a\u6240\u9700\u7684token\u3002"),(0,i.kt)("h4",{id:"212-\u4f7f\u7528token"},"2.1.2 \u4f7f\u7528token"),(0,i.kt)("p",null,"\u5728\u5f97\u5230\u6240\u9700\u7684token\u4fe1\u606f\u540e\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u6240\u6709\u9700\u8981\u9274\u6743\u7684\u8d44\u6e90\u65f6\uff0c\u53ef\u4ee5\u5728\u8bf7\u6c42\u5934\u6216\u8005\u8bf7\u6c42\u53c2\u6570\u4e2d\u643a\u5e26\u4e0a\u6b64token\u503c\u5373\u53ef\u3002\u643a\u5e26token\u503c\u5f97\u8bf7\u6c42\u5934\u7684\u540d\u5b57\u548c\u643a\u5e26token\u503c\u5f97\u8bf7\u6c42\u53c2\u6570\u7684\u540d\u5b57\u53ef\u4ee5\u901a\u914d\u7f6e\u8fdb\u884c\u6539\u53d8\uff0c\u9ed8\u8ba4\u914d\u7f6e\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u4ece\u8bf7\u6c42\u5934\u91cc\u53d6\u51fa\u8ba4\u8bc1\u4fe1\u606f\u65f6\u7684\u53c2\u6570\u540d\uff0c\u9ed8\u8ba4\u4e3a xtoken\nyishuifengxiao.security.token.header-parameter=xtoken\n#\u4ece\u8bf7\u6c42\u53c2\u6570\u91cc\u53d6\u51fa\u8ba4\u8bc1\u4fe1\u606f\u65f6\u7684\u53c2\u6570\u540d\uff0c\u9ed8\u8ba4\u4e3a xtoken \nyishuifengxiao.security.token.request-parameter=xtoken\n")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u5728\u82e5\u5728\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u53c2\u6570\u4e2d\u5747\u4e3a\u83b7\u53d6\u5230token\u4fe1\u606f\u65f6\uff0c\u7ec4\u4ef6\u8fd8\u4f1a\u9ed8\u8ba4\u4ecesession\u4e2d\u5c1d\u8bd5\u83b7\u53d6token\u503c\uff0c\u4ecesession\u4e2d\u83b7\u53d6\u6570\u636e\u7684key\u7684\u914d\u7f6e\u53ef\u4ee5\u4fee\u6539"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u7528\u6237\u552f\u4e00\u6807\u8bc6\u7b26\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e3auser_unique_identitier\nyishuifengxiao.security.token.user-unique-identitier=user_unique_identitier\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"}," \u6ce8\u610f\u70b9\uff1a\u63d0\u53d6token\u503c\u4f9d\u6b21\u4ece\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u53c2\u6570\u548csession\u4e2d\u83b7\u53d6\uff0c\u53ea\u8981\u5728\u524d\u4e00\u79cd\u65b9\u5f0f\u4e2d\u83b7\u53d6\u5230\u5c31\u4e0d\u4f1a\u5c1d\u8bd5\u4e0b\u4e00\u79cd\uff08\u6b64\u65f6\u4e0d\u4f1a\u6821\u9a8ctoken\u503c\u5f97\u6b63\u786e\u6027\uff09")),(0,i.kt)("p",null,"\u4f7f\u7528token\u7684\u8bf7\u6c42\u793a\u4f8b\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl --location --request GET 'http://localhost:8080/user/find?xtoken=60C45471AF39D9C3726150DEF5513E69184205C922B4670E4EB79EB3748E6F585F06ADCA94688AE406DFE549FF29E182A831DDC995A98489'\n")),(0,i.kt)("p",null,"\u6216\u8005"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl --location --request GET 'http://localhost:8080/user/find' \\\n--header 'xtoken: 60C45471AF39D9C3726150DEF5513E69184205C922B4670E4EB79EB3748E6F585F06ADCA94688AE406DFE549FF29E182A831DDC995A98489'\n")),(0,i.kt)("h3",{id:"22-\u8fdb\u9636\u4f7f\u7528"},"2.2 \u8fdb\u9636\u4f7f\u7528"),(0,i.kt)("h4",{id:"221-\u57fa\u7840\u8fdb\u9636"},"2.2.1 \u57fa\u7840\u8fdb\u9636"),(0,i.kt)("p",null,"\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u7ec4\u4ef6\u7684\u9ed8\u8ba4\u914d\u7f6e\u5f80\u5f80\u4e0d\u80fd\u6ee1\u8db3\u591a\u53d8\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728\u7cfb\u7edf\u4e2d\u6ce8\u5165\u4e00\u4e2aSecurityHandler\u7684\u5b9e\u4f8b\u6765\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8fdb\u884c\u5b9a\u5236\uff0c\u7b80\u5355\u7684\u793a\u4f8b\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"@Component\npublic class SimpleSecurityHandler extends BaseSecurityHandler {\n    @Override\n    public void whenAuthenticationSuccess(PropertyResource propertyResource, HttpServletRequest request, HttpServletResponse response, Authentication authentication, SecurityToken token) throws IOException {\n        super.whenAuthenticationSuccess(propertyResource, request, response, authentication, token);\n    }\n\n    @Override\n    public void whenAuthenticationFailure(PropertyResource propertyResource, HttpServletRequest request, HttpServletResponse response, Exception exception) throws IOException {\n        super.whenAuthenticationFailure(propertyResource, request, response, exception);\n    }\n\n    @Override\n    public void whenLogoutSuccess(PropertyResource propertyResource, HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException {\n        super.whenLogoutSuccess(propertyResource, request, response, authentication);\n    }\n\n    @Override\n    public void whenAccessDenied(PropertyResource propertyResource, HttpServletRequest request, HttpServletResponse response, AccessDeniedException exception) throws IOException {\n        super.whenAccessDenied(propertyResource, request, response, exception);\n    }\n\n    @Override\n    public void onException(PropertyResource propertyResource, HttpServletRequest request, HttpServletResponse response, Exception exception) throws IOException {\n        super.onException(propertyResource, request, response, exception);\n    }\n\n    @Override\n    public void preAuth(PropertyResource propertyResource, HttpServletRequest request, HttpServletResponse response, Response<CustomException> data) throws IOException {\n        super.preAuth(propertyResource, request, response, data);\n    }\n}\n")),(0,i.kt)("h4",{id:"222-\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55"},"2.2.2 \u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55"),(0,i.kt)("p",null,"\u9a8c\u8bc1\u7801\u7684\u4f7f\u7528\u53c2\u89c1\u524d\u8ff0\u7ae0\u8282"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#\u77ed\u4fe1\u767b\u9646\u53c2\u6570,\u9ed8\u8ba4\u4e3a mobile \nyishuifengxiao.security.code.sms-login-param=mobile\n#\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55\u5730\u5740\nyishuifengxiao.security.code.sms-login-url=/web/sms_login\n")),(0,i.kt)("p",null,"\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u5373\u53ef\u5f00\u542f\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55\u529f\u80fd\u3002"),(0,i.kt)("h4",{id:"223-\u9a8c\u8bc1\u7801\u4f7f\u7528"},"2.2.3 \u9a8c\u8bc1\u7801\u4f7f\u7528"),(0,i.kt)("p",null,"\u6309\u7167\u524d\u8ff0\u7ae0\u8282\u914d\u7f6e\u597d\u9a8c\u8bc1\u7801\u4e4b\u540e\u3002\u5373\u53ef\u5c06spring security\u4e0e\u9a8c\u8bc1\u7801\u529f\u80fd\u7ed3\u5408\u8d77\u6765\u3002\u5728\u9879\u76ee\u91cc\u52a0\u4e0a\u914d\u7f6e"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties"},"#key\uff1a\u9a8c\u8bc1\u7801\u7c7b\u578b\u7684\u540d\u5b57\uff08\u53ef\u9009\u503c\uff1aSMS\uff0cIMAGE\uff0cEMAIL\uff09, value: \u9700\u8981\u8fc7\u6ee4\u7684\u8def\u5f84\uff0c\u591a\u4e2a\u8def\u5f84\u91c7\u7528\u534a\u89d2\u7684\u9017\u53f7\u5206\u9694\nyishuifengxiao.security.code.filter.image=/aaa,/bb\n")),(0,i.kt)("h3",{id:"23-\u9ad8\u7ea7\u4f7f\u7528"},"2.3 \u9ad8\u7ea7\u4f7f\u7528"),(0,i.kt)("h4",{id:"231-\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668"},"2.3.1 \u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668"),(0,i.kt)("p",null,"\u5728spring security \u8fc7\u6ee4\u5668\u94fe\u4e2d\u63d2\u5165\u4e00\u4e2a\u8fc7\u6ee4\u5668\u3002"),(0,i.kt)("p",null,"\u5728spring \u4e0a\u4e0b\u6587\u4e2d\u6ce8\u5165\u4e00\u4e2a",(0,i.kt)("inlineCode",{parentName:"p"},"com.yishuifengxiao.common.security.httpsecurity.SecurityRequestFilter"),"\u7684\u5b9e\u4f8b\u5373\u53ef\uff0c\u914d\u7f6e\u5b8c\u6210\u540e\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"public void configure(HttpSecurity http) throws Exception"),"\u4e2d\u914d\u7f6e\u597d\u8fc7\u6ee4\u5668\u751f\u6548\u4f4d\u7f6e\u5373\u53ef\u3002"),(0,i.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class UsernamePasswordPreAuthFilter extends SecurityRequestFilter {\n\n    private AntPathRequestMatcher pathMatcher = null;\n\n    private SecurityHandler securityHandler;\n\n    private UserDetailsService userDetailsService;\n\n    private PasswordEncoder passwordEncoder;\n\n    private PropertyResource propertyResource;\n\n    /**\n     * \u4fe1\u606f\u63d0\u53d6\u5668\n     */\n    private SecurityValueExtractor securityValueExtractor;\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n            throws ServletException, IOException {\n        // \u662f\u5426\u5173\u95ed\u524d\u7f6e\u53c2\u6570\u6821\u9a8c\u529f\u80fd\n        Boolean closePreAuth = propertyResource.security().getClosePreAuth();\n        if (BooleanUtils.isNotTrue(closePreAuth)) {\n            AntPathRequestMatcher pathMatcher = this.antPathMatcher();\n            if (pathMatcher.matches(request)) {\n\n                String username = securityValueExtractor.extractUsername(request, response);\n                String password = securityValueExtractor.extractPassword(request, response);\n\n                if (username == null) {\n                    username = "";\n                }\n                if (password == null) {\n                    password = "";\n                }\n\n                username = username.trim();\n\n                try {\n                    // \u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\n                    try {\n                        UserDetails userDetails = userDetailsService.loadUserByUsername(username);\n                        if (null == userDetails) {\n                            throw new CustomException(ErrorCode.USERNAME_NO_EXTIS,\n                                    propertyResource.security().getMsg().getAccountNoExtis());\n                        }\n                        if (!passwordEncoder.matches(password, userDetails.getPassword())) {\n                            throw new CustomException(ErrorCode.PASSWORD_ERROR,\n                                    propertyResource.security().getMsg().getPasswordIsError());\n                        }\n                    } catch (UsernameNotFoundException ex) {\n                        throw new CustomException(ErrorCode.USERNAME_NO_EXTIS,\n                                propertyResource.security().getMsg().getAccountNoExtis());\n                    }\n                } catch (Exception exception) {\n                    securityHandler.whenAuthenticationFailure(propertyResource, request, response, exception);\n                    return;\n                }\n\n            }\n        }\n\n        filterChain.doFilter(request, response);\n    }\n\n    @Override\n    public void configure(HttpSecurity http) throws Exception {\n        http.addFilterBefore(this, UsernamePasswordAuthenticationFilter.class);\n\n    }\n\n    /**\n     * \u83b7\u53d6\u5230\u8def\u5f84\u5339\u914d\u5668\n     *\n     * @return \u8def\u5f84\u5339\u914d\u5668\n     */\n    private AntPathRequestMatcher antPathMatcher() {\n        if (null == this.pathMatcher) {\n            this.pathMatcher = new AntPathRequestMatcher(this.propertyResource.security().getFormActionUrl());\n        }\n        return this.pathMatcher;\n    }\n\n    // @formatter:off\n    public UsernamePasswordPreAuthFilter(SecurityHandler securityHandler,\n                                         UserDetailsService userDetailsService,\n                                         PasswordEncoder passwordEncoder,\n                                         PropertyResource propertyResource,\n                                         SecurityValueExtractor securityValueExtractor) {\n        this.securityHandler = securityHandler;\n        this.userDetailsService = userDetailsService;\n        this.passwordEncoder = passwordEncoder;\n        this.propertyResource = propertyResource;\n        this.securityValueExtractor = securityValueExtractor;\n    }\n    // @formatter:on\n}\n')),(0,i.kt)("h4",{id:"232-\u81ea\u5b9a\u4e49\u6388\u6743\u914d\u7f6e"},"2.3.2 \u81ea\u5b9a\u4e49\u6388\u6743\u914d\u7f6e"),(0,i.kt)("p",null,"\u4e3b\u8981\u7528\u4e8e\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"HttpSecurity http"),"\u4e0a\u8fdb\u884c\u5404\u9879\u6388\u6743\u914d\u7f6e\u3002\u53ea\u9700\u8981\u5728spring \u4e0a\u4e0b\u6587\u4e2d\u6ce8\u5165",(0,i.kt)("inlineCode",{parentName:"p"},"AuthorizeProvider"),"\u5b9e\u4f8b\u5373\u53ef\u3002",(0,i.kt)("inlineCode",{parentName:"p"},"AuthorizeProvider"),"\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"public interface AuthorizeProvider {\n\n    /**\n     * \u6388\u6743\u914d\u7f6e\n     *\n     * @param propertyResource               \u6388\u6743\u8d44\u6e90\n     * @param  securityHandler \u7528\u4e8e\u5728\u5404\u79cd Handler \u4e2d\u6839\u636e\u60c5\u51b5\u76f8\u5e94\u5730\u8df3\u8f6c\u5230\u6307\u5b9a\u7684\u9875\u9762\u6216\u8005\u8f93\u51fajson\u683c\u5f0f\u7684\u6570\u636e\n     * @param http HttpSecurity\n     * @throws Exception \u914d\u7f6e\u65f6\u51fa\u73b0\u95ee\u9898\n     */\n    void apply(PropertyResource propertyResource, SecurityHandler securityHandler, HttpSecurity http) throws Exception;\n\n    /**\n     * \u6388\u6743\u63d0\u4f9b\u5668\u7684\u987a\u5e8f\uff0c\u6570\u5b57\u8d8a\u5c0f\u8d8a\u662f\u63d0\u524d\u4f7f\u7528\uff0c\u9ed8\u8ba4\u503c\u4e3a100\n     *\n     * @return \u6388\u6743\u63d0\u4f9b\u5668\u7684\u987a\u5e8f\n     */\n    default int order() {\n        return 100;\n    }\n}\n")),(0,i.kt)("p",null,"\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"public class ExceptionAuthorizeProvider implements AuthorizeProvider {\n\n\n    @Override\n    public void apply(PropertyResource propertyResource, SecurityHandler securityHandler, HttpSecurity http) throws Exception {\n        //@formatter:off\n        http.exceptionHandling()\n      // \u5b9a\u4e49\u7684\u4e0d\u5b58\u5728access_token\u65f6\u5019\u54cd\u5e94\n      .authenticationEntryPoint(securityHandler).accessDeniedHandler(securityHandler)\n      //\u81ea\u5b9a\u4e49\u6743\u9650\u62d2\u7edd\u5904\u7406\u5668\n      ;\n      //@formatter:on  \n    }\n\n    @Override\n    public int order() {\n        return 1000;\n    }\n}\n")),(0,i.kt)("h4",{id:"233-token\u751f\u6210\u5de5\u5177"},"2.3.3 token\u751f\u6210\u5de5\u5177"),(0,i.kt)("p",null,"API\u5217\u8868\u5982\u4e0b:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"th"},"\u9650\u5b9a\u7b26\u548c\u7c7b\u578b")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"th"},"\u65b9\u6cd5\u548c\u8bf4\u660e")))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"create(javax.servlet.http.HttpServletRequest request, String username, String password)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"create(String username, String password)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"create(String username, String password, String sessionId)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"createUnsafe(javax.servlet.http.HttpServletRequest request, String username)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"createUnsafe(javax.servlet.http.HttpServletRequest request, String username, int validSeconds)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"createUnsafe(String username)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"createUnsafe(String username, int validSeconds)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"createUnsafe(String username, String sessionId)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"static SecurityToken"),(0,i.kt)("td",{parentName:"tr",align:null},"createUnsafe(String username, String sessionId, int validSeconds)\u751f\u6210\u4e00\u4e2a\u4ee4\u724c")))))}d.isMDXComponent=!0}}]);