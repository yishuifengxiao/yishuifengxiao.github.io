<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-common-starter docs-doc-id-oauth2-server/oauth2">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">oauth2简介 | 易水风萧</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yishuifengxiao.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://yishuifengxiao.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://yishuifengxiao.github.io/common-starter/oauth2-server/oauth2"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-common-starter-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-common-starter-current"><meta data-rh="true" property="og:title" content="oauth2简介 | 易水风萧"><meta data-rh="true" name="description" content="OAuth 2.1 和 OAuth 2.0 区别"><meta data-rh="true" property="og:description" content="OAuth 2.1 和 OAuth 2.0 区别"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yishuifengxiao.github.io/common-starter/oauth2-server/oauth2"><link data-rh="true" rel="alternate" href="https://yishuifengxiao.github.io/common-starter/oauth2-server/oauth2" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://yishuifengxiao.github.io/common-starter/oauth2-server/oauth2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="易水风萧 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="易水风萧 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.cc1417fc.css">
<link rel="preload" href="/assets/js/runtime~main.be2b926a.js" as="script">
<link rel="preload" href="/assets/js/main.389b831d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">易水风萧</b></a><a class="navbar__item navbar__link" href="/common-tool">通用工具</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/common-starter">增强组件</a></div><div class="navbar__items navbar__items--right"><a href="http://www.yishuifengxiao.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">个人博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/yishuifengxiao/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/common-starter/">快速入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/common-starter/web">web增强</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/common-starter/swagger">swagger增强</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/common-starter/cache">通用增强</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/common-starter/code">验证码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/common-starter/jdbc">spring data jdbc</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/common-starter/category/spring-security">spring security</a><button aria-label="打开/收起侧边栏菜单「spring security」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/common-starter/category/oauth2-server">oauth2 server</a><button aria-label="打开/收起侧边栏菜单「oauth2 server」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/common-starter/oauth2-server/oauth2">oauth2简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/common-starter/oauth2-server/">快速入门</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/common-starter/category/oauth2-resource">oauth2 resource</a><button aria-label="打开/收起侧边栏菜单「oauth2 resource」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/common-starter/category/oauth2client">oauth2Client</a><button aria-label="打开/收起侧边栏菜单「oauth2Client」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/common-starter/category/oauth2login">oauth2Login</a><button aria-label="打开/收起侧边栏菜单「oauth2Login」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>oauth2简介</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="oauth-21-和-oauth-20-区别">OAuth 2.1 和 OAuth 2.0 区别<a href="#oauth-21-和-oauth-20-区别" class="hash-link" aria-label="OAuth 2.1 和 OAuth 2.0 区别的直接链接" title="OAuth 2.1 和 OAuth 2.0 区别的直接链接">​</a></h2><p>OAuth 2.1正在整合自OAuth 2发布以来八年来所学到的最佳实践。原始OAuth 2.0规范于2012年10月发布为RFC 6749和RFC 6750。它取代了2010年4月发布的OAuth 1.0。在随后的几年中，对OAuth 2进行了许多扩展和修改。</p><p>目前正在讨论中已经提出了一个新的OAuth规范。此规范最近于2020年7月30日更新。如果获得批准，OAuth 2.1将淘汰OAuth 2.0的某些部分，并强制执行安全最佳实践。OAuth 2.0规范的其余部分将被保留。这一点很重复，它不会添加任何新内容。这是OAuth 2.1的明确设计目标。</p><p>OAuth 2.1 是 OAuth 2.0 的下一个版本, OAuth 2.1 根据最佳安全实践(BCP), 目前是第18个版本，对 OAuth 2.0 协议进行整合和精简, 移除不安全的授权流程, 并发布了 OAuth 2.1 规范草案, 下面列出了和 OAuth 2.0 相比的主要区别。</p><p>相关概念如下:</p><ul><li>A是用户正在交互的一段代码；浏览器、本机应用程序或单页应用程序都是客户端</li><li>OAuth服务器实现了OAuth规范。它具有或可以获得关于哪些资源可供客户端使用的信息。在RFC中，此应用程序称为授权服务器。这也称为身份提供者。大多数用户称之为“我登录的地方”。</li><li>没有任何身份验证功能，而是将登录请求委托给OAuth服务器。它有一个允许OAuth服务器识别它的id</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="推荐使用-authorization-code--pkce">推荐使用 Authorization Code + PKCE<a href="#推荐使用-authorization-code--pkce" class="hash-link" aria-label="推荐使用 Authorization Code + PKCE的直接链接" title="推荐使用 Authorization Code + PKCE的直接链接">​</a></h3><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18#section-2.1.1" target="_blank" rel="noopener noreferrer">根据 OAuth 2.0 安全最佳实践(Security Best Current Practices) 2.1.1 章节</a></p><p>授权码 (Authorization Code) 模式大家都很熟悉了,也是最安全的授权流程, 那 PKCE 又是什么呢? PKCE 全称是 Proof Key for Code Exchange, 在 2015 年发布为 RFC 7636, 我们知道, 授权码模式虽好, 但是它不能给公开的客户端用, 因为公开的客户端没有能力保存好秘钥(client_secret), 所以在此之前, 对于公开的客户端, 只能使用隐式模式和密码模式, PKCE 就是为了解决这个问题而出现的, 另外它也可以防范授权码拦截攻击, 实际上它的原理是客户端提供一个自创建的证明给授权服务器， 授权服务器通过它来验证客户端，把访问令牌(access_token) 颁发给真实的客户端而不是伪造的。</p><p>代码交换证明密钥（PKCE）RFC于2015年发布，它扩展了授权代码授权，以防止在非TLS连接上发生部分授权流时受到攻击。例如，如果本地应用程序的组件之间存在通信，就会发生这种情况。</p><p>如果TLS存在漏洞，或者用户的路由器固件受到破坏，并且正在欺骗DNS或将TLS降级为HTTP，也可能发生此攻击。PKCE需要生成额外的一次性代码并将其发送到OAuth服务器。此代码验证请求是否未被拦截或修改。</p><p>OAuth 2.1规范草案要求在每次授权代码授予时都使用PKCE挑战，以防止授权代码被攻击者劫持并用于获取令牌。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="隐式授权-implicit-grant已弃用">隐式授权（ Implicit Grant）已弃用<a href="#隐式授权-implicit-grant已弃用" class="hash-link" aria-label="隐式授权（ Implicit Grant）已弃用的直接链接" title="隐式授权（ Implicit Grant）已弃用的直接链接">​</a></h3><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18#section-2.1.2" target="_blank" rel="noopener noreferrer">根据 OAuth 2.0 安全最佳实践(Security Best Current Practices) 2.1.2 章节</a></p><p>在 OAuth 2.1 规范草案中, 授权模式中已经找不到隐式授权(Implicit Grant), 我们知道, 隐式授权是 OAuth 2.0 中的授权模式, 是授权码模式的简化版本, 用户同意授权后, 直接就能返回访问令牌 access_token, 同时这种也是不安全的。</p><blockquote><p>根据OAuth 2.0安全最佳当前实践第2.1.2节，本规范中省略了隐式授权（“response_type=token”）</p></blockquote><p>隐式授权在单页应用程序（SPA）中使用时固有地不安全。如果您使用此授权，您的访问令牌将暴露给浏览器中与SPA一起运行的任何JavaScript。如果不小心，您将获得URL片段中的访问令牌，该令牌存储在本地存储中，或者放在非HttpOnly cookie中。在所有情况下，获得访问令牌的攻击者都可以像原始用户一样访问资源。这不是一个好情况。</p><p>访问令牌不一定是一次性使用的，并且可以使用几分钟到几天，具体取决于OAuth服务器的配置方式。如果它们被盗，它们保护的资源将不再安全。你可能会想“嗯，我的网站上没有恶意JavaScript。”你确定吗？您是否审核了所有代码及其依赖项、依赖项和依赖项？您是否自动审核代码？广泛的依赖关系树可能会导致意外的安全问题：有人接管了一个开源节点库，并添加了下载了数百万次的恶意代码。</p><p>使用SPA隐式授权最不安全的方法的,在这种情况下，访问令牌作为HttpOnly cookie提供给SPA。最后，它基本上重新创建了授权代码授权，说明了隐式授权是如何变得安全的。</p><p>OAuth 2.1规范草案省略了隐式授权。这意味着任何实现OAuth 2.1的软件都不必实现该授权。如果您在应用程序中使用此授权，那么如果您希望符合OAuth 2.1，则必须将其替换为其他授权。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="密码授权-resource-owner-password-credentials-grant已弃用">密码授权 （Resource Owner Password Credentials Grant）已弃用<a href="#密码授权-resource-owner-password-credentials-grant已弃用" class="hash-link" aria-label="密码授权 （Resource Owner Password Credentials Grant）已弃用的直接链接" title="密码授权 （Resource Owner Password Credentials Grant）已弃用的直接链接">​</a></h3><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18#section-2.4" target="_blank" rel="noopener noreferrer">根据 OAuth 2.0 安全最佳实践(Security Best Current Practices) 2.4 章节</a></p><p>在 OAuth 2.1 规范草案中, 密码授权也被移除, 实际上这种授权模式在 OAuth 2.0中都是不推荐使用的, 密码授权的流程是, 用户把账号密码告诉客户端, 然后客户端再去申请访问令牌, 这种模式只在用户和客户端高度信任的情况下才使用。</p><p>试想一下, 在你手机上有一个网易云音乐的APP, 现在要使用qq账号登录, 这时网易云音乐说, 你把qq账号密码告诉我就行了, 我拿着你的账号密码去QQ那边登录, 这就很离谱了!</p><p>正确的做法是, 用户在网易云音乐要使用qq登录, 如果用户也安装了qq 的客户端, 应该唤起qq应用, 在qq页面完成授权操作, 然后返回到网易云音乐。如果用户没有安装qq客户端应用, 唤起浏览器, 引导用户去qq的授权页面, 用户授权完成后, 返回到网易云音乐。</p><p>请注意, OAuth 是专门为委托授权而设计的，为了让第三方应用使用授权, 它不是为身份验证而设计的, 而 OpenID Connect（建立在 OAuth 之上）是专为身份验证而设计, 所以, 在使用 OAuth 授权协议时, 你需要知道你使用的客户端是第三方应用程序还是第一方应用，这很重要！因为 OAuth 2.1 已经不支持第一方应用授权！</p><p>现在您可以考虑使用 Authorization Code + PKCE 替换之前的密码授权模式。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-access_token-时-不应该通过-url-传递-token">使用 access_token 时, 不应该通过 URL 传递 token<a href="#使用-access_token-时-不应该通过-url-传递-token" class="hash-link" aria-label="使用 access_token 时, 不应该通过 URL 传递 token的直接链接" title="使用 access_token 时, 不应该通过 URL 传递 token的直接链接">​</a></h3><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18#section-4.3.2" target="_blank" rel="noopener noreferrer">根据 OAuth 2.0 安全最佳实践(Security Best Current Practices) 4.3.2 章节</a></p><p>在使用 access_token 时, 您不应该把token放到URL中, 第一, 浏览器地址栏本来就是暴露的, 第二, 可以查看浏览记录，找到 access_token。</p><p>正确的做法是, 把 access_token 放到 Http header 或者是 POST body 中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="刷新令牌-refresh-token-应该是一次性的">刷新令牌 (Refresh Token) 应该是一次性的<a href="#刷新令牌-refresh-token-应该是一次性的" class="hash-link" aria-label="刷新令牌 (Refresh Token) 应该是一次性的的直接链接" title="刷新令牌 (Refresh Token) 应该是一次性的的直接链接">​</a></h3><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18#section-4.13.2" target="_blank" rel="noopener noreferrer">根据 OAuth 2.0 安全最佳实践(Security Best Current Practices) 4.13.2 章节</a></p><p>access_token 访问令牌, refresh_token 刷新令牌, 刷新令牌可以在一段时间内获取访问令牌, 平衡了用户体验和安全性, 在 OAuth 2.1 中, refresh_token 应该是一次性的, 用过后失效, 使用 refresh_token 获取access_token时, 还可以返回一个新的 refresh_token。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="回调地址redirect-uri应该精确匹配">回调地址（Redirect URI）应该精确匹配<a href="#回调地址redirect-uri应该精确匹配" class="hash-link" aria-label="回调地址（Redirect URI）应该精确匹配的直接链接" title="回调地址（Redirect URI）应该精确匹配的直接链接">​</a></h3><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18#section-4.1.3" target="_blank" rel="noopener noreferrer">根据 OAuth 2.0 安全最佳实践(Security Best Current Practices) 4.1.3 章节</a></p><p>在 OAuth 2.0 的授权码流程中, 需要设置一个回调地址 redirect_uri, 如下</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://www.authorization-server.com/oauth2/authorize?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">response_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">s6BhdRkqt3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">scope</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">state</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">8b815ab1d177f5c8e </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">redirect_uri</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://www.client.com/callback</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>假如有三个不同的客户端</p><ul><li>a.client.com</li><li>b.client.com</li><li>c.client.com</li></ul><p>这时可能会使用一个通配符的 redirect_uri, 比如 *.client.com, 这样会有什么风险呢? 实际上, 恶意程序有机会篡改 redirect_uri, 假设恶意程序的域名是 <a href="https://attacker.com/" target="_blank" rel="noopener noreferrer">https://attacker.com</a>, 然后把 redirect_uri 改成 <a href="https://attacker.com/.client.com" target="_blank" rel="noopener noreferrer">https://attacker.com/.client.com</a>, 这样授权码就发送给了恶意程序。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="参考文档">参考文档<a href="#参考文档" class="hash-link" aria-label="参考文档的直接链接" title="参考文档的直接链接">​</a></h3><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-04" target="_blank" rel="noopener noreferrer">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-04</a></p><p><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18" target="_blank" rel="noopener noreferrer">OAuth 2.0 Security Best Current Practice draft-ietf-oauth-security-topics-18</a></p><p><a href="https://fusionauth.io/learn/expert-advice/oauth/differences-between-oauth-2-oauth-2-1/" target="_blank" rel="noopener noreferrer">https://fusionauth.io/learn/expert-advice/oauth/differences-between-oauth-2-oauth-2-1</a></p><p>OAuth 2.0 Authorization Server Metadata <a href="https://www.rfc-editor.org/rfc/rfc8414#section-3" target="_blank" rel="noopener noreferrer">https://www.rfc-editor.org/rfc/rfc8414#section-3</a></p><p>The OAuth 2.1 Authorization Framework <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-07#section-1.1" target="_blank" rel="noopener noreferrer">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-07#section-1.1</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="oauth-20--四种授权方式">OAuth 2.0  四种授权方式<a href="#oauth-20--四种授权方式" class="hash-link" aria-label="OAuth 2.0  四种授权方式的直接链接" title="OAuth 2.0  四种授权方式的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="密码模式">密码模式<a href="#密码模式" class="hash-link" aria-label="密码模式的直接链接" title="密码模式的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /oauth/token HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Host: oauth2.yishuifengxiao.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Authorization: Basic fdsfdsfdsfds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     grant_type=password&amp;username=johndoe&amp;password=A3ddj3w</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在请求中，各参数的含义如下</p><ul><li>grant_type：表示授权类型，此处的值固定为&quot;password&quot;，必选项。</li><li>username：表示用户名，必选项。</li><li>password：表示用户的密码，必选项。</li><li>scope：表示权限范围，可选项。</li><li>Authorization: 请求头参数 ，值是 clientId:clientSecret 经过 base64 编码后的值</li></ul><p>下面是一个响应的例子</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;access_token&quot;: &quot;BDF867DE69F05143C709&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;token_type&quot;: &quot;bearer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;refresh_token&quot;: &quot;d7cda8fb15714209a9f9f3b039a0034f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires_in&quot;: 43199,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;scope&quot;: &quot;read write trust&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;client_id&quot;: &quot;yishui&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端模式">客户端模式<a href="#客户端模式" class="hash-link" aria-label="客户端模式的直接链接" title="客户端模式的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /oauth/token HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Host: oauth2.yishuifengxiao.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Authorization: Basic fdsfdsfdsfds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     grant_type=client_credentials</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在本请求中，各参数的含义如下</p><ul><li>grant_type：表示授权类型，此处的值固定为&quot;client_credentials&quot;，必选项。</li><li>Authorization: 请求头参数 ，值是 clientId:clientSecret 经过 base64 编码后的值</li></ul><p>下面是一个响应的例子</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;access_token&quot;: &quot;BDF867DE69F05143D3BF&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;token_type&quot;: &quot;bearer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires_in&quot;: 43199,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;scope&quot;: &quot;read write trust&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;client_id&quot;: &quot;yishui&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>同密码模式相比，客户端模式的响应中缺少了 <code>refresh_token</code> 参数</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="授权码模式">授权码模式<a href="#授权码模式" class="hash-link" aria-label="授权码模式的直接链接" title="授权码模式的直接链接">​</a></h3><p>授权码模式首先需要保证 spring security 的登陆功能正常可用。只有开启 spring security 的登陆功能可用，才能开启授权码功能。</p><p>先访问一下请求</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /oauth/authorize?response_type=code&amp;client_id=yishui&amp;state=xyz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;redirect_uri=http://demo.yishuifengxiao.com/demo HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: oauth2.yishuifengxiao.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在本请求中，各参数的含义如下：</p><ul><li>code：表示授权码，必选项。该码的有效期应该很短，通常设为 10 分钟，客户端只能使用该码一次，否则会被授权服务器拒绝。该码与客户端 ID 和重定向 URI，是一一对应关系。</li><li>state：如果客户端的请求中包含这个参数，认证服务器的回应也必须一模一样包含这个参数。</li><li>client_id： 用户的 client_id</li></ul><p>在进行此请求时，假如用户没有登录，spring security 会进行拦截，因此需要用户先进行登录。</p><p>在正常情况下，访问以上请求会被重定向到</p><p><a href="http://demo.yishuifengxiao.com/demo?code=fsfsdf" target="_blank" rel="noopener noreferrer">http://demo.yishuifengxiao.com/demo?code=fsfsdf</a>
&amp;state=xyz</p><p>服务器回应客户端的 URI，包含以下参数：</p><ul><li>code：表示授权码，必选项。该码的有效期应该很短，通常设为 10 分钟，客户端只能使用该码一次，否则会被授权服务器拒绝。该码与客户端 ID 和重定向 URI，是一一对应关系。</li><li>state：如果客户端的请求中包含这个参数，认证服务器的回应也必须一模一样包含这个参数。</li></ul><p>通过上面的请求得到了<code>code</code>以后，用户需要使用下面请求获取到授权码</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /oauth/token HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: oauth2.yishuifengxiao.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Basic fdsfdsfdsfds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grant_type=authorization_code&amp;code=fsfsdf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;redirect_uri=demo.yishuifengxiao.com/demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在本请求中，各参数的含义如下：</p><ul><li>grant_type：表示使用的授权模式，必选项，此处的值固定为&quot;authorization_code&quot;。</li><li>code：表示上一步获得的授权码，必选项。</li><li>redirect_uri：表示重定向 URI，必选项，且必须与 A 步骤中的该参数值保持一致。</li><li>client_id：表示客户端 ID，必选项。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="简化模式">简化模式<a href="#简化模式" class="hash-link" aria-label="简化模式的直接链接" title="简化模式的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /oauth/authorize?response_type=token&amp;client_id=yishui&amp;state=xyz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;redirect_uri=http://demo.com/demo    HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host: server.example.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在本请求中，各参数的含义如下：</p><ol><li>response_type：表示授权类型，此处的值固定为&quot;token&quot;，必选项。</li><li>client_id：表示客户端的 ID，必选项。</li><li>redirect_uri：表示重定向的 URI，可选项。</li><li>scope：表示权限范围，可选项。</li><li>state：表示客户端的当前状态，可以指定任意值，认证服务器会原封不动地返回这个值。</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="刷新-token">刷新 token<a href="#刷新-token" class="hash-link" aria-label="刷新 token的直接链接" title="刷新 token的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /oauth/token HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Host: oauth2.yishuifengxiao.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Authorization: Basic fdsfdsfdsfds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     grant_type=refresh_token&amp;refresh_token=sdff</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>请求中个参数的含义:</p><ul><li>granttype：表示使用的授权模式，此处的值固定为&quot;refresh_token&quot;，必选项。</li><li>refresh_token：表示早前收到的更新令牌，必选项。</li><li>scope：表示申请的授权范围，不可以超出上一次申请的范围，如果省略该参数，则表示与上一次一致。</li></ul><br><hr><br><h3 class="anchor anchorWithStickyNavbar_LWe7" id="access_token-使用">access_token 使用<a href="#access_token-使用" class="hash-link" aria-label="access_token 使用的直接链接" title="access_token 使用的直接链接">​</a></h3><p>通过 前面的方法获取到 access_token 之后，一般有两种使用方法</p><ul><li>将 access_token 做为请求参数携带在 url 参数上</li></ul><blockquote><p><a href="http://demo.yishuifengxiao.com/user/123?access_token=%E8%8E%B7%E5%BE%97%E5%88%B0%E7%9A%84access_token" target="_blank" rel="noopener noreferrer">http://demo.yishuifengxiao.com/user/123?access_token=获得到的access_token</a></p></blockquote><ul><li>将 access_token 做为请求参数放在请求头中</li></ul><blockquote><p>在所有需要授权的请求的请求头里都携带上参数
Authorization=Bearer 获得到的 access_token</p></blockquote><p>在通用组件中，由于对<code>access_token</code>进行了深度处理，因此用户可以<code>access_token</code>通过易水工具包里的 DES 工具饭解析出 token 里携带的信息。</p><p>在解密时需要使用的密钥由【安全管理】中设置的<code>yishuifengxiao.security.secret-key</code>属性值决定。</p><p>下面是一个 <code>access_token</code> 的解密信息示例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;username&quot;: &quot;yishui&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;clientId&quot;: &quot;admin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ROLE_USER&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;grantType&quot;: &quot;password&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解密信息的各参数的解释：</p><ul><li>username： 用户登录时使用到的用户名(在客户端模式下该值为空)</li><li>clientId： 用户登录时使用的 clientId(在简化模式下该值为空)</li><li>roles： 此登录用户拥有的角色(即此用户的 authorities)</li><li>grantType：access_token 对应的授权类型</li></ul><blockquote><p>由<code>access_token</code>反解析出用户信息仅限于本组件，原生的 oauth2 的<code>access_token</code>不支持此功能</p></blockquote><p><strong>在本组件中，每次访问后都会重置令牌的自动过期时间</strong></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>yishuifengxiao</b> <!-- -->于 <b><time datetime="2023-02-14T07:38:30.000Z">2023年2月14日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/common-starter/category/oauth2-server"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">oauth2 server</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/common-starter/oauth2-server/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">快速入门</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#oauth-21-和-oauth-20-区别" class="table-of-contents__link toc-highlight">OAuth 2.1 和 OAuth 2.0 区别</a><ul><li><a href="#推荐使用-authorization-code--pkce" class="table-of-contents__link toc-highlight">推荐使用 Authorization Code + PKCE</a></li><li><a href="#隐式授权-implicit-grant已弃用" class="table-of-contents__link toc-highlight">隐式授权（ Implicit Grant）已弃用</a></li><li><a href="#密码授权-resource-owner-password-credentials-grant已弃用" class="table-of-contents__link toc-highlight">密码授权 （Resource Owner Password Credentials Grant）已弃用</a></li><li><a href="#使用-access_token-时-不应该通过-url-传递-token" class="table-of-contents__link toc-highlight">使用 access_token 时, 不应该通过 URL 传递 token</a></li><li><a href="#刷新令牌-refresh-token-应该是一次性的" class="table-of-contents__link toc-highlight">刷新令牌 (Refresh Token) 应该是一次性的</a></li><li><a href="#回调地址redirect-uri应该精确匹配" class="table-of-contents__link toc-highlight">回调地址（Redirect URI）应该精确匹配</a></li><li><a href="#参考文档" class="table-of-contents__link toc-highlight">参考文档</a></li></ul></li><li><a href="#oauth-20--四种授权方式" class="table-of-contents__link toc-highlight">OAuth 2.0  四种授权方式</a><ul><li><a href="#密码模式" class="table-of-contents__link toc-highlight">密码模式</a></li><li><a href="#客户端模式" class="table-of-contents__link toc-highlight">客户端模式</a></li><li><a href="#授权码模式" class="table-of-contents__link toc-highlight">授权码模式</a></li><li><a href="#简化模式" class="table-of-contents__link toc-highlight">简化模式</a></li><li><a href="#刷新-token" class="table-of-contents__link toc-highlight">刷新 token</a></li><li><a href="#access_token-使用" class="table-of-contents__link toc-highlight">access_token 使用</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">快速开始</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io/zh-CN/docs/configuration" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/yishuifengxiao/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.be2b926a.js"></script>
<script src="/assets/js/main.389b831d.js"></script>
</body>
</html>